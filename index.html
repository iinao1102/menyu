import React, { useState, useEffect, useRef, useCallback } from 'react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signInWithEmailAndPassword, signOut } from 'firebase/auth';
import { getFirestore, collection, onSnapshot, addDoc, setDoc, deleteDoc, doc, query, where, getDocs, writeBatch } from 'firebase/firestore'; // writeBatch を追加
import {
    ChefHat, Utensils, Wine, Cake, Fish, Beef, Plus, Trash2, Edit, X,
    CheckCircle, AlertTriangle, Info, Loader2, User, ChevronLeft, ChevronRight
} from 'lucide-react';

// Firebaseのグローバル変数を使用 (Canvas環境で提供される)
// 開発環境で動作しない場合は、Firebaseプロジェクトの構成でこれらの変数を手動で設定してください
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

// Firebase初期化 (コンポーネント外で一度だけ実行)
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// カテゴリ定義 (アイコンと多言語名を含む)
const ALL_CATEGORIES = [
    { key: 'antipasti', icon: ChefHat, jp: 'オードブル', en: 'Appetizers' },
    { key: 'pasta-risotto', icon: Utensils, jp: 'パスタ・リゾット', en: 'Pasta & Risotto' },
    { key: 'secondi-pesce', icon: Fish, jp: 'セコンド・ピアット（魚）', en: 'Main Course (Fish)' },
    { key: 'secondi-carne', icon: Beef, jp: 'セコンド・ピアット（肉）', en: 'Main Course (Meat)' },
    { key: 'dolci-cafe', icon: Cake, jp: 'デザート・カフェ', en: 'Dessert & Cafe' },
    { key: 'bevande', icon: Wine, jp: 'ドリンク', en: 'Beverages' }
];

// ドリンクサブカテゴリの定義（表示順と表示形式を制御）
const DRINK_SUB_CATEGORIES = [
    { key: 'red-wine', jp: '赤ワイン', en: 'Red Wine', hasImage: true, hasDescription: true },
    { key: 'white-wine', jp: '白ワイン', en: 'White Wine', hasImage: true, hasDescription: true },
    { key: 'sparkling-wine', jp: 'スパークリングワイン', en: 'Sparkling Wine', hasImage: true, hasDescription: false },
    { key: 'aperitif', jp: '食前酒', en: 'Aperitif', hasImage: false, hasDescription: true },
    { key: 'whisky', jp: 'ウィスキー', en: 'Whisky', hasImage: false, hasDescription: true },
    { key: 'digestivo', jp: '食後酒', en: 'Digestivo', hasImage: false, hasDescription: true },
    { key: 'non-alcohol-wine', jp: 'ノンアルコールワイン', en: 'Non Alcohol Wine', hasImage: false, hasDescription: false },
    { key: 'soft-drink', jp: 'ソフトドリンク', en: 'Soft Drink', hasImage: false, hasDescription: false },
];


// UIテキストの多言語マッピング
const UI_TEXTS = {
    'menu_title': { 'jp': 'メニュー', 'en': 'MENU' },
    'allergens_title': { 'jp': 'アレルギー情報:', 'en': 'Allergens:' },
    'image_not_found': { 'jp': '画像が見つかりません', 'en': 'Image Not Found' },
    'no_menu_available': { 'jp': '現在、このカテゴリのメニューはありません。', 'en': 'No menu available in this category.' },
    'no_description': { 'jp': '説明がありません。', 'en': 'No description available.' },
    'no_allergens': { 'jp': 'なし', 'en': 'None' },
    'add_item': { 'jp': '新規追加', 'en': 'Add New Item' },
    'edit_item': { 'jp': '編集', 'en': 'Edit Item' },
    'delete_item': { 'jp': '削除', 'en': 'Delete Item' },
    'save': { 'jp': '保存', 'en': 'Save' },
    'cancel': { 'jp': 'キャンセル', 'en': 'Cancel' },
    'confirm_delete_title': { 'jp': 'メニュー項目を削除', 'en': 'Delete Menu Item' },
    'confirm_delete_message': { 'jp': '本当にこのメニュー項目を削除しますか？', 'en': 'Are you sure you want to delete this menu item?' },
    'delete_button': { 'jp': '削除', 'en': 'Delete' },
    'admin_mode': { 'jp': '管理者モード', 'en': 'Admin Mode' },
    'loading_data': { 'jp': 'データを読み込み中...', 'en': 'Loading data...' },
    'authentication_failed': { 'jp': '認証に失敗しました。', 'en': 'Authentication failed.' },
    'error_fetching_data': { 'jp': 'データの取得中にエラーが発生しました。', 'en': 'Error fetching data.' },
    'no_data_found': { 'jp': 'メニューデータが見つかりませんでした。', 'en': 'No menu data found.' },
    'category': { 'jp': 'カテゴリ', 'en': 'Category' },
    'name_jp': { 'jp': '日本語名', 'en': 'Japanese Name' },
    'name_en': { 'jp': '英語名', 'en': 'English Name' },
    'description_jp': { 'jp': '日本語の説明', 'en': 'Japanese Description' },
    'description_en': { 'jp': '英語の説明', 'en': 'English Description' },
    'price_display_jp': { 'jp': '表示価格 (JP)', 'en': 'Display Price (JP)' },
    'price_display_en': { 'jp': '表示価格 (EN)', 'en': 'Display Price (EN)' },
    'allergens_jp': { 'jp': '日本語のアレルゲン', 'en': 'Japanese Allergens' },
    'allergens_en': { 'jp': '英語のアレルゲン', 'en': 'English Allergens' },
    'image_url': { 'jp': '画像URL', 'en': 'Image URL' },
    'required_field': { 'jp': '必須項目です。', 'en': 'This field is required.' },
    'user_id': {'jp': 'ユーザーID:', 'en': 'User ID:'},
    'is_public': {'jp': '公開する', 'en': 'Make Public'},
    // パスタの注意書き用の新しいテキスト
    'pasta_note_gluten_free': {
        'jp': 'パスタをグルテンフリー（玄米）に変更出来ます',
        'en': 'You can change your pasta to gluten-free (brown rice).'
    },
    'pasta_note_portions': {
        'jp': 'パスタの分量を変更出来ます',
        'en': 'You can change the amount of pasta.'
    },
    'pasta_note_normal': { 'jp': '普通', 'en': 'Normal' },
    'pasta_note_large': { 'jp': '大盛', 'en': 'Large' },
    'pasta_note_extra_large': { 'jp': '特盛', 'en': 'Extra Large' },
    'pasta_note_small': { 'jp': '少なめ', 'en': 'Small' },
    'pasta_note_price_change': { 'jp': '※お値段は分量によって変わります。', 'en': '*Prices vary depending on the amount.' },
    'dessert_set_option': { 'jp': '〈デザートセット時', 'en': '<When ordering with dessert set' },
    'set_option_prefix': { 'jp': '〈セット時', 'en': '<With set' },
    'desserts_title': { 'jp': 'デザート', 'en': 'Desserts' },
    'cafe_title': { 'jp': 'カフェ', 'en': 'Cafe' },
    // ドリンクサブカテゴリのタイトル
    'red_wine_title': { 'jp': '赤ワイン', 'en': 'Red Wine' },
    'white_wine_title': { 'jp': '白ワイン', 'en': 'White Wine' },
    'sparkling_wine_title': { 'jp': 'スパークリングワイン', 'en': 'Sparkling Wine' },
    'aperitif_title': { 'jp': '食前酒', 'en': 'Aperitif' },
    'whisky_title': { 'jp': 'ウィスキー', 'en': 'Whisky' },
    'digestivo_title': { 'jp': '食後酒', 'en': 'Digestivo' },
    'non_alcohol_wine_title': { 'jp': 'ノンアルコールワイン', 'en': 'Non Alcohol Wine' },
    'soft_drink_title': { 'jp': 'ソフトドリンク', 'en': 'Soft Drink' },
    'whisky_note': {'jp': '（Sodaハイボール+￥100（110））', 'en': '(with Soda Highball +$1.00 ($1.10))'},
    'recommended_pairings': { 'jp': 'おすすめのペアリングワイン', 'en': 'Recommended Wine Pairings' },
    'no_pairings_found': { 'jp': 'このメニューにはおすすめのワインが見つかりませんでした。', 'en': 'No recommended wines found for this item.' },
    'close': { 'jp': '閉じる', 'en': 'Close' },
    'tap_for_details': { 'jp': 'タップで詳細', 'en': 'Tap for details' },
    'admin_login_title': {'jp': '管理者ログイン', 'en': 'Admin Login'},
    'admin_email_label': {'jp': 'メールアドレス', 'en': 'Email Address'},
    'admin_password_label': {'jp': 'パスワード', 'en': 'Password'},
    'admin_login_button': {'jp': 'ログイン', 'en': 'Login'},
    'admin_logout_button': {'jp': 'ログアウト', 'en': 'Logout'},
    'admin_logged_in_message': {'jp': '管理者としてログイン中。', 'en': 'Logged in as Admin.'},
    'login_error_invalid_credentials': {'jp': 'メールアドレスまたはパスワードが間違っています。', 'en': 'Invalid email or password.'},
    'login_error_too_many_requests': {'jp': '連続したログイン試行により、一時的にアカウントがロックされました。しばらくしてからお試しください。', 'en': 'Account temporarily locked due to too many login attempts. Please try again later.'},
    'login_error_generic': {'jp': 'ログインに失敗しました。', 'en': 'Login failed.'}
};

// メッセージ表示コンポーネント
const MessageDisplay = ({ message, type }) => {
    const Icon = {
        'info': Info,
        'success': CheckCircle,
        'warning': AlertTriangle,
        'error': X
    }[type] || Info;

    const colors = {
        'info': 'text-blue-600 bg-blue-50 border-blue-200',
        'success': 'text-green-600 bg-green-50 border-green-200',
        'warning': 'text-yellow-600 bg-yellow-50 border-yellow-200',
        'error': 'text-red-600 bg-red-50 border-red-200'
    };

    return (
        <div className={`flex items-center p-4 rounded-lg border ${colors[type]} shadow-sm max-w-lg mx-auto my-6`} role="alert">
            <Icon className="w-6 h-6 mr-3 flex-shrink-0" />
            <p className="text-sm font-medium">{message}</p>
        </div>
    );
};

// 確認モーダルコンポーネント
const ConfirmModal = ({ show, title, message, onConfirm, onCancel, currentLanguage }) => {
    if (!show) return null;

    return (
        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in">
            <div className="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm transform scale-95 animate-scale-in">
                <h3 className="font-bold text-xl text-gray-800 mb-4">{title}</h3>
                <p className="text-gray-600 mb-6">{message}</p>
                <div className="flex justify-end space-x-3">
                    <button
                        onClick={onCancel}
                        className="px-5 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors duration-200 text-sm font-medium"
                    >
                        {UI_TEXTS['cancel'][currentLanguage]}
                    </button>
                    <button
                        onClick={onConfirm}
                        className="px-5 py-2 rounded-md bg-red-600 text-white hover:bg-red-700 transition-colors duration-200 text-sm font-medium"
                    >
                        {UI_TEXTS['delete_button'][currentLanguage]}
                    </button>
                </div>
            </div>
        </div>
    );
};

// メニュー項目詳細・編集モーダル
const MenuItemModal = ({ item, onClose, onSubmit, currentLanguage, categories }) => {
    const isNew = !item;
    const [formData, setFormData] = useState(item || {
        Category: categories[0]?.key || '',
        Type: 'dessert', // Default for dolci-cafe. Will be set to first drink type if 'bevande' selected.
        Name_jp: '', Name_en: '',
        Description_jp: '', Description_en: '',
        PriceDisplay_jp: '', PriceDisplay_en: '',
        Allergens_jp: '', Allergens_en: '',
        ImageUrl: '',
        IsPublic: true // 新規追加時はデフォルトで公開
    });
    const [errors, setErrors] = useState({});
    const modalRef = useRef(null);
    const firstFieldRef = useRef(null);

    // Update Type when Category changes
    useEffect(() => {
        if (formData.Category === 'dolci-cafe' && !['dessert', 'cafe'].includes(formData.Type)) {
            setFormData(prev => ({ ...prev, Type: 'dessert' }));
        } else if (formData.Category === 'bevande' && !DRINK_SUB_CATEGORIES.some(d => d.key === formData.Type)) {
            setFormData(prev => ({ ...prev, Type: DRINK_SUB_CATEGORIES[0]?.key || '' }));
        }
    }, [formData.Category]);


    const validateForm = () => {
        const newErrors = {};
        if (!formData.Category) newErrors.Category = UI_TEXTS['required_field'][currentLanguage];
        if (!formData.Name_jp) newErrors.Name_jp = UI_TEXTS['required_field'][currentLanguage];
        if (!formData.Name_en) newErrors.Name_en = UI_TEXTS['required_field'][currentLanguage];
        if (!formData.PriceDisplay_jp) newErrors.PriceDisplay_jp = UI_TEXTS['required_field'][currentLanguage];
        // PriceDisplay_en は PriceDisplay_jp から自動生成されるので必須チェックは不要
        setErrors(newErrors);
        return Object.keys(newErrors).length === 0;
    };

    const handleChange = (e) => {
        const { name, value, type, checked } = e.target;
        setFormData(prev => ({
            ...prev,
            [name]: type === 'checkbox' ? checked : value
        }));
    };

    const handleSubmit = async (e) => {
        e.preventDefault();
        if (!validateForm()) {
            return;
        }
        await onSubmit(formData);
        onClose();
    };

    useEffect(() => {
        if (modalRef.current) {
            firstFieldRef.current?.focus();
            const focusableElements = modalRef.current.querySelectorAll(
                'button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])'
            );
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];

            const handleTabKey = (e) => {
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === firstElement) {
                            lastElement.focus();
                        }
                    } else {
                        if (document.activeElement === lastElement) {
                            firstElement.focus();
                        }
                    }
                    e.preventDefault();
                }
            };

            modalRef.current.addEventListener('keydown', handleTabKey);
            return () => {
                modalRef.current?.removeEventListener('keydown', handleTabKey);
            };
        }
    }, [item]); // isEditMode は不要、itemの有無で判断できるため

    return (
        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in">
            <div ref={modalRef} className="bg-white rounded-lg shadow-xl p-6 w-full max-w-xl max-h-[90vh] overflow-y-auto relative transform scale-95 animate-scale-in">
                <button
                    onClick={onClose}
                    className="absolute top-3 right-3 text-gray-500 hover:text-gray-700 p-2 rounded-full hover:bg-gray-100 transition-colors"
                    aria-label={UI_TEXTS['cancel'][currentLanguage]}
                >
                    <X className="w-6 h-6" />
                </button>
                <h3 className="font-bold text-2xl text-gray-800 mb-6 text-center">
                    {isNew ? UI_TEXTS['add_item'][currentLanguage] : UI_TEXTS['edit_item'][currentLanguage]}
                </h3>
                <form onSubmit={handleSubmit} className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="md:col-span-2">
                        <label htmlFor="Category" className="block text-sm font-medium text-gray-700 mb-1">
                            {UI_TEXTS['category'][currentLanguage]}
                        </label>
                        <select
                            id="Category"
                            name="Category"
                            value={formData.Category}
                            onChange={handleChange}
                            className={`mt-1 block w-full px-3 py-2 border ${errors.Category ? 'border-red-500' : 'border-gray-300'} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm`}
                            ref={firstFieldRef}
                        >
                            {categories.map((cat) => (
                                <option key={cat.key} value={cat.key}>
                                    {cat[currentLanguage]}
                                </option>
                            ))}
                        </select>
                        {errors.Category && <p className="text-red-500 text-xs mt-1">{errors.Category}</p>}
                    </div>

                    {/* Type field for dolci-cafe and bevande category */}
                    {(formData.Category === 'dolci-cafe' || formData.Category === 'bevande') && (
                        <div className="md:col-span-2">
                            <label htmlFor="Type" className="block text-sm font-medium text-gray-700 mb-1">
                                タイプ
                            </label>
                            <select
                                id="Type"
                                name="Type"
                                value={formData.Type}
                                onChange={handleChange}
                                className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                            >
                                {formData.Category === 'dolci-cafe' && (
                                    <>
                                        <option value="dessert">デザート</option>
                                        <option value="cafe">カフェ</option>
                                    </>
                                )}
                                {formData.Category === 'bevande' && (
                                    <>
                                        {DRINK_SUB_CATEGORIES.map(type => (
                                            <option key={type.key} value={type.key}>{type.jp}</option>
                                        ))}
                                    </>
                                )}
                            </select>
                        </div>
                    )}


                    <div>
                        <label htmlFor="Name_jp" className="block text-sm font-medium text-gray-700 mb-1">
                            {UI_TEXTS['name_jp'][currentLanguage]}
                        </label>
                        <input
                            type="text"
                            id="Name_jp"
                            name="Name_jp"
                            value={formData.Name_jp}
                            onChange={handleChange}
                            className={`mt-1 block w-full px-3 py-2 border ${errors.Name_jp ? 'border-red-500' : 'border-gray-300'} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm`}
                        />
                        {errors.Name_jp && <p className="text-red-500 text-xs mt-1">{errors.Name_jp}</p>}
                    </div>
                    <div>
                        <label htmlFor="Name_en" className="block text-sm font-medium text-gray-700 mb-1">
                            {UI_TEXTS['name_en'][currentLanguage]}
                        </label>
                        <input
                            type="text"
                            id="Name_en"
                            name="Name_en"
                            value={formData.Name_en}
                            onChange={handleChange}
                            className={`mt-1 block w-full px-3 py-2 border ${errors.Name_en ? 'border-red-500' : 'border-gray-300'} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm`}
                        />
                        {errors.Name_en && <p className="text-red-500 text-xs mt-1">{errors.Name_en}</p>}
                    </div>

                    <div className="md:col-span-2">
                        <label htmlFor="Description_jp" className="block text-sm font-medium text-gray-700 mb-1">
                            {UI_TEXTS['description_jp'][currentLanguage]}
                        </label>
                        <textarea
                            id="Description_jp"
                            name="Description_jp"
                            value={formData.Description_jp}
                            onChange={handleChange}
                            rows="3"
                            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                        ></textarea>
                    </div>
                    <div className="md:col-span-2">
                        <label htmlFor="Description_en" className="block text-sm font-medium text-gray-700 mb-1">
                            {UI_TEXTS['description_en'][currentLanguage]}
                        </label>
                        <textarea
                            id="Description_en"
                            name="Description_en"
                            value={formData.Description_en}
                            onChange={handleChange}
                            rows="3"
                            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                        ></textarea>
                    </div>

                    <div>
                        <label htmlFor="PriceDisplay_jp" className="block text-sm font-medium text-gray-700 mb-1">
                            {UI_TEXTS['price_display_jp'][currentLanguage]}
                        </label>
                        <input
                            type="text"
                            id="PriceDisplay_jp"
                            name="PriceDisplay_jp"
                            value={formData.PriceDisplay_jp}
                            onChange={handleChange}
                            className={`mt-1 block w-full px-3 py-2 border ${errors.PriceDisplay_jp ? 'border-red-500' : 'border-gray-300'} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm`}
                            placeholder="例: グラス ¥800 (968) / デカンタ ¥3,100 (3,751)"
                        />
                        {errors.PriceDisplay_jp && <p className="text-red-500 text-xs mt-1">{errors.PriceDisplay_jp}</p>}
                    </div>
                    <div>
                        <label htmlFor="PriceDisplay_en" className="block text-sm font-medium text-gray-700 mb-1">
                            {UI_TEXTS['price_display_en'][currentLanguage]}
                        </label>
                        <input
                            type="text"
                            id="PriceDisplay_en"
                            name="PriceDisplay_en"
                            value={formData.PriceDisplay_en}
                            onChange={handleChange}
                            className={`mt-1 block w-full px-3 py-2 border ${errors.PriceDisplay_en ? 'border-red-500' : 'border-gray-300'} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm`}
                            placeholder="例: Glass $7.27 (Tax incl. $8.79) / Decanter $28.18 (Tax incl. $34.09)"
                        />
                        {errors.PriceDisplay_en && <p className="text-red-500 text-xs mt-1">{errors.PriceDisplay_en}</p>}
                    </div>

                    <div className="md:col-span-2">
                        <label htmlFor="Allergens_jp" className="block text-sm font-medium text-gray-700 mb-1">
                            {UI_TEXTS['allergens_jp'][currentLanguage]}
                        </label>
                        <input
                            type="text"
                            id="Allergens_jp"
                            name="Allergens_jp"
                            value={formData.Allergens_jp}
                            onChange={handleChange}
                            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                        />
                    </div>
                    <div className="md:col-span-2">
                        <label htmlFor="Allergens_en" className="block text-sm font-medium text-gray-700 mb-1">
                            {UI_TEXTS['allergens_en'][currentLanguage]}
                        </label>
                        <input
                            type="text"
                            id="Allergens_en"
                            name="Allergens_en"
                            value={formData.Allergens_en}
                            onChange={handleChange}
                            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                        />
                    </div>

                    <div className="md:col-span-2">
                        <label htmlFor="ImageUrl" className="block text-sm font-medium text-gray-700 mb-1">
                            {UI_TEXTS['image_url'][currentLanguage]}
                        </label>
                        <input
                            type="text"
                            id="ImageUrl"
                            name="ImageUrl"
                            value={formData.ImageUrl}
                            onChange={handleChange}
                            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                            placeholder="例: https://example.com/image.jpg (画像不要の場合は空欄)"
                        />
                        {formData.ImageUrl && (
                            <img src={formData.ImageUrl} alt="プレビュー" className="mt-3 w-32 h-32 object-cover rounded-md shadow-md mx-auto" onError={(e) => e.target.src = 'https://placehold.co/128x128/CCCCCC/666666?text=No+Image'} />
                        )}
                    </div>

                    {/* 公開トグル */}
                    <div className="md:col-span-2 flex items-center justify-between p-2 bg-gray-50 rounded-md border border-gray-200">
                        <label htmlFor="IsPublic" className="text-sm font-medium text-gray-700 cursor-pointer">
                            {UI_TEXTS['is_public'][currentLanguage]}
                        </label>
                        <input
                            type="checkbox"
                            id="IsPublic"
                            name="IsPublic"
                            checked={formData.IsPublic}
                            onChange={handleChange}
                            className="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"
                        />
                    </div>

                    <div className="md:col-span-2 flex justify-end space-x-3 mt-6">
                        <button
                            type="button"
                            onClick={onClose}
                            className="px-6 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors duration-200 font-medium"
                        >
                            {UI_TEXTS['cancel'][currentLanguage]}
                        </button>
                        <button
                            type="submit"
                            className="px-6 py-2 rounded-md bg-indigo-600 text-white hover:bg-indigo-700 transition-colors duration-200 font-medium"
                        >
                            {UI_TEXTS['save'][currentLanguage]}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    );
};

// メニュー項目詳細表示モーダル
const MenuItemDetailModal = ({ item, allMenuItems, onClose, currentLanguage }) => {
    if (!item) return null;

    const getRecommendedWines = (selectedItem, allItems, lang) => {
        const pairings = [];
        const wines = allItems.filter(i => i.Category === 'bevande' && (i.Type === 'red-wine' || i.Type === 'white-wine' || i.Type === 'sparkling-wine' || i.Type === 'rosé-wine'));

        // Simplified pairing logic
        if (selectedItem.Category === 'secondi-carne' || (selectedItem.Category === 'pasta-risotto' && selectedItem.Name_jp.includes('ボロネーゼ'))) {
            // Meat dishes and Bolognese pasta pair well with red wine
            pairings.push(...wines.filter(w => w.Type === 'red-wine'));
        } else if (selectedItem.Category === 'secondi-pesce' || (selectedItem.Category === 'antipasti' && !selectedItem.Name_jp.includes('肉'))) {
            // Fish, appetizers without meat, and most pasta/risotto pair with white or sparkling
            pairings.push(...wines.filter(w => w.Type === 'white-wine' || w.Type === 'sparkling-wine'));
        } else if (selectedItem.Category === 'dolci-cafe' && selectedItem.Type === 'dessert') {
            // Desserts can go with sweet sparkling or specific dessert wines (if any)
            pairings.push(...wines.filter(w => w.Type === 'sparkling-wine' && w.Name_jp.includes('モスカート'))); // Sweet sparkling
            pairings.push(...allItems.filter(w => w.Category === 'bevande' && w.Type === 'digestivo' && w.Name_jp.includes('パッシート'))); // Passito for dessert
        } else if (selectedItem.Category === 'antipasti' && selectedItem.Name_jp.includes('ハムとチーズ')) {
             pairings.push(...wines.filter(w => w.Type === 'red-wine' || w.Type === 'white-wine' || w.Type === 'sparkling-wine'));
        }

        // Remove duplicates and limit to a reasonable number
        const uniquePairings = Array.from(new Set(pairings.map(p => p.id)))
                                .map(id => pairings.find(p => p.id === id));
        return uniquePairings.slice(0, 3); // Limit to 3 recommendations
    };

    const recommendedWines = getRecommendedWines(item, allMenuItems, currentLanguage);

    const formatPriceDisplay = (priceString, lang) => {
        if (!priceString) return null;
        // Split by " / " and render each part on a new line
        return priceString.split(' / ').map((part, index) => (
            <p key={index} className="text-red-600 font-bold text-lg leading-tight mb-1">
                {part}
            </p>
        ));
    };


    return (
        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 sm:p-6 animate-fade-in">
            <div className="bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[95vh] overflow-y-auto relative transform scale-95 animate-scale-in">
                <div className="sticky top-0 bg-white p-4 pb-2 border-b border-gray-200 z-10 flex justify-between items-center">
                    <button
                        onClick={onClose}
                        className="p-2 rounded-full text-gray-600 hover:bg-gray-100 transition-colors"
                        aria-label={UI_TEXTS['close'][currentLanguage]}
                    >
                        <ChevronLeft className="w-6 h-6" />
                    </button>
                    <h3 className="font-playfair text-2xl font-bold text-red-800 text-center flex-grow">
                        {item[`Name_${currentLanguage}`]}
                    </h3>
                    <div className="w-10"></div> {/* Spacer to balance the back button */}
                </div>

                <div className="p-4 sm:p-6">
                    {item.ImageUrl && (
                        <img
                            src={item.ImageUrl}
                            alt={item.Name_jp}
                            className="w-full h-48 sm:h-64 object-cover rounded-lg mb-6 shadow-md"
                            onError={(e) => e.target.src = 'https://placehold.co/600x400/CCCCCC/666666?text=Image+Not+Found'}
                        />
                    )}

                    <div className="mb-6">
                        {formatPriceDisplay(item[`PriceDisplay_${currentLanguage}`], currentLanguage)}
                        <p className="text-gray-700 text-base leading-relaxed mt-4">
                            {item[`Description_${currentLanguage}`] && item[`Description_${currentLanguage}`] !== UI_TEXTS['no_description'][currentLanguage] ?
                                item[`Description_${currentLanguage}`] : UI_TEXTS['no_description'][currentLanguage]}
                        </p>
                    </div>

                    <div className="bg-gray-50 p-4 rounded-lg mb-6 shadow-sm">
                        <p className="text-gray-700 text-sm">
                            <span className="font-semibold text-gray-800">{UI_TEXTS['allergens_title'][currentLanguage]}</span>{' '}
                            {item[`Allergens_${currentLanguage}`] && item[`Allergens_${currentLanguage}`] !== UI_TEXTS['no_allergens'][currentLanguage] ?
                                item[`Allergens_${currentLanguage}`] : UI_TEXTS['no_allergens'][currentLanguage]}
                        </p>
                    </div>

                    {recommendedWines.length > 0 && (
                        <div className="mt-8 bg-red-50 p-4 rounded-lg shadow-md">
                            <h4 className="font-playfair text-xl font-semibold text-red-700 mb-4">
                                {UI_TEXTS['recommended_pairings'][currentLanguage]}
                            </h4>
                            <ul className="space-y-3">
                                {recommendedWines.map(wine => (
                                    <li key={wine.id} className="flex items-start space-x-3">
                                        {wine.ImageUrl && (
                                            <img
                                                src={wine.ImageUrl}
                                                alt={wine.Name_jp}
                                                className="w-16 h-16 object-cover rounded-md flex-shrink-0 shadow-sm"
                                                onError={(e) => e.target.src = 'https://placehold.co/64x64/CCCCCC/666666?text=Wine'}
                                            />
                                        )}
                                        <div className="flex-grow">
                                            <p className="font-medium text-gray-800 text-base leading-tight">
                                                {wine[`Name_${currentLanguage}`]}
                                            </p>
                                            {formatPriceDisplay(wine[`PriceDisplay_${currentLanguage}`], currentLanguage)}
                                            {wine[`Description_${currentLanguage}`] && wine[`Description_${currentLanguage}`] !== UI_TEXTS['no_description'][currentLanguage] && (
                                                <p className="text-gray-600 text-xs mt-1 line-clamp-2">
                                                    {wine[`Description_${currentLanguage}`]}
                                                </p>
                                            )}
                                        </div>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    )}
                     {recommendedWines.length === 0 && (
                        <div className="mt-8 bg-gray-50 p-4 rounded-lg shadow-sm">
                            <p className="text-gray-600 text-sm italic">
                                {UI_TEXTS['no_pairings_found'][currentLanguage]}
                            </p>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );
};


// アプリケーションのメインコンポーネント
const App = () => {
    const [currentLanguage, setCurrentLanguage] = useState('jp'); // 'jp' または 'en'
    const [menuItems, setMenuItems] = useState([]);
    const [selectedCategory, setSelectedCategory] = useState(ALL_CATEGORIES[0].key);
    const [isAdminMode, setIsAdminMode] = useState(false); // 管理者モードUIトグル（認証とは別）
    const [isAdminUser, setIsAdminUser] = useState(false); // 実際にFirebaseで認証された管理者か
    const [showItemModal, setShowItemModal] = useState(false);
    const [editingItem, setEditingItem] = useState(null);
    const [showConfirmModal, setShowConfirmModal] = useState(false);
    const [itemToDelete, setItemToDelete] = useState(null);
    const [message, setMessage] = useState('');
    const [messageType, setMessageType] = useState('info');
    const [isLoading, setIsLoading] = useState(true);
    const [userId, setUserId] = useState('ゲスト'); // ユーザーIDステート
    const [isAuthReady, setIsAuthReady] = useState(false); // 認証準備完了フラグ

    // 詳細画面表示用のstate
    const [showDetailModal, setShowDetailModal] = useState(false);
    const [selectedDetailItem, setSelectedDetailItem] = useState(null);

    const messageTimeoutRef = useRef(null); // メッセージ表示タイマーの参照

    // 管理者ログイン用のステート
    const [adminEmail, setAdminEmail] = useState('');
    const [adminPassword, setAdminPassword] = useState('');
    const [adminLoginError, setAdminLoginError] = useState(null);
    const [isLoggingIn, setIsLoggingIn] = useState(false); // ログイン処理中か

    // メッセージ表示関数
    const showAndHideMessage = useCallback((msg, type = 'info', duration = 3000) => {
        if (messageTimeoutRef.current) {
            clearTimeout(messageTimeoutRef.current);
        }
        setMessage(msg);
        setMessageType(type);
        messageTimeoutRef.current = setTimeout(() => {
            setMessage('');
            setMessageType('info');
        }, duration);
    }, []);

    // Firebase認証初期化と認証状態の監視
    useEffect(() => {
        const unsubscribeAuth = onAuthStateChanged(auth, async (user) => {
            if (user) {
                setUserId(user.uid);
                console.log("Firebase: User is signed in. UID:", user.uid);

                // **ここに管理者UIDを設定してください**
                // Firebase Authenticationで作成した管理者のUIDを配列に追加します。
                // 例: const adminUids = ["your-admin-uid-12345", "another-admin-uid-67890"];
                const adminUids = ["YOUR_ADMIN_UID_1", "YOUR_ADMIN_UID_2"]; // <-- ここを変更
                setIsAdminUser(adminUids.includes(user.uid)); // 実際に認証された管理者か判定
                console.log("Is Admin User:", adminUids.includes(user.uid));

                // 初回ログイン時に匿名認証だった場合、カスタムトークンがあればそれに切り替える
                if (user.isAnonymous && initialAuthToken) {
                    try {
                        await signInWithCustomToken(auth, initialAuthToken);
                        console.log("Firebase: Switched from anonymous to custom token.");
                    } catch (error) {
                        console.error("Firebase: Error switching to custom token:", error);
                        // showAndHideMessage(`${UI_TEXTS['authentication_failed'][currentLanguage]} ${error.message}`, 'error', 10000); // 開発中のデバッグ用
                    }
                }
            } else {
                setUserId('ゲスト');
                setIsAdminUser(false); // ログインしていないので管理者ではない
                setMenuItems([]); // ログアウトしたらメニューをクリア（または公開アイテムのみ表示）
                setIsLoading(false);
                console.log("Firebase: No user is signed in. Showing as Guest.");

                // 匿名認証を試みる (既存のコードの挙動を維持)
                try {
                    await signInAnonymously(auth);
                    console.log("Firebase: Signed in anonymously after logout/no initial user.");
                } catch (anonError) {
                    console.error("Firebase: Error signing in anonymously:", anonError);
                    showAndHideMessage(`${UI_TEXTS['authentication_failed'][currentLanguage]} ${anonError.message}`, 'error', 10000);
                }
            }
            setIsAuthReady(true); // 認証処理が完了したことをマーク
        });

        return () => unsubscribeAuth();
    }, []); // 空の依存配列で一度だけ実行

    // Firestoreデータ購読 (認証が完了してから開始)
    useEffect(() => {
        let unsubscribeFirestore = () => {};

        if (isAuthReady) {
            setIsLoading(true);
            const publicMenuCollectionRef = collection(db, `artifacts/${appId}/public/data/menu`);

            // 初回読み込み時にデータがなければサンプルデータを投入
            const populateSampleData = async () => {
                const querySnapshot = await getDocs(publicMenuCollectionRef);
                if (querySnapshot.empty) {
                    console.log("Firestore: Public menu collection is empty. Populating with sample data...");
                    const batch = writeBatch(db); // バッチ処理を開始

                    const sampleItems = [
                        // オードブル (Appetizers)
                        createMenuItem('antipasti', '', 'いろいろなオードブル盛合せ', '¥2,000 (2,420)', 'Assorted Appetizers', 'シェフおすすめの彩り豊かなオードブルの盛り合わせです。', 'Chef\'s recommended colorful assortment of appetizers.', 'アレルゲンは内容による', 'Allergens vary', 'https://placehold.co/400x200/FFDDC1/8B4513?text=Assorted+Appetizers'),
                        createMenuItem('antipasti', '', 'ホワイトアスパラガスと玉子のグラタン ミラノ風', '¥3,400 (4,114)', 'Baked White Asparagus & Egg Gratin Milanese Style', 'ホワイトアスパラガスと卵をトリュフオイルで香り高く焼き上げました。', 'White asparagus and egg baked fragrantly with truffle oil.', '卵、乳', 'Egg, Dairy', 'https://placehold.co/400x200/C1FFDD/138B45?text=Asparagus+Gratin'),
                        createMenuItem('antipasti', '', 'タコとセロリのサラダ', '¥1,700 (2,057)', 'Octopus & Celery Salad', '新鮮なタコとシャキシャキのセロリを特製ドレッシングで。', 'Fresh octopus and crisp celery with special dressing.', 'なし', 'None', 'https://placehold.co/400x200/ADD8E6/4682B4?text=Octopus+Salad'),
                        createMenuItem('antipasti', '', '本日のスープ', '¥1,000 (1,210)', 'Today\'s Soup', '毎日変わる、シェフ特製の温かいスープです。', 'Chef\'s special warm soup, changing daily.', 'アレルゲンは内容による', 'Allergens vary', 'https://placehold.co/400x200/DDA0DD/800080?text=Today\'s+Soup'),
                        createMenuItem('antipasti', '', 'フルーツトマトとストラッチャテッラチーズのカプレーゼ', '¥1,900 (2,299)', 'Fruit Tomato & Stracciatella Cheese Caprese', '甘みの強いフルーツトマトとクリーミーなストラッチャテッラチーズのマリアージュ。', 'A marriage of sweet fruit tomatoes and creamy stracciatella cheese.', '乳', 'Dairy', 'https://placehold.co/400x200/FFB6C1/8B0000?text=Tomato+Caprese'),
                        createMenuItem('antipasti', '', 'ナスとチーズのオーブン焼', '¥1,700 (2,057)', 'Baked Eggplant & Cheese', 'トロトロのナスととろけるチーズをオーブンで香ばしく焼き上げました。', 'Tender eggplant and melted cheese baked until fragrant.', '乳', 'Dairy', 'https://placehold.co/400x200/D2B48C/5F4B3B?text=Baked+Eggplant'),
                        createMenuItem('antipasti', '', '本日の鮮魚のカルパッチョ サラダ添え', '¥1,900～ (2,299～)', 'Today\'s Fresh Fish Carpaccio with Salad', 'その日に仕入れた新鮮な魚介を薄切りにし、彩り野菜と共に。', 'Thinly sliced fresh fish of the day, served with colorful vegetables.', '魚', 'Fish', 'https://placehold.co/400x200/ADD8E6/000080?text=Fish+Carpaccio'),
                        createMenuItem('antipasti', '', 'カラマリフリット', '¥1,800 (2,178)', 'Deep Fried Calamari (Calamari Fritto)', 'サクサクとした衣と柔らかいイカの食感が楽しめるイタリア風フリット。', 'Crispy fried squid, an Italian-style fried dish.', '小麦、イカ', 'Wheat, Squid', 'https://placehold.co/400x200/E6E6FA/7B68EE?text=Calamari+Fritto'),
                        createMenuItem('antipasti', '', '生ハムとフルーツ', '¥2,000～ (2,420～)', 'Prosciutto & Fresh Fruit of the day', '旬の甘いフルーツと、塩気のある熟成生ハムの絶妙な組み合わせ。', 'A perfect combination of sweet seasonal fruits and savory aged prosciutto.', 'なし', 'None', 'https://placehold.co/400x200/FFDDC1/8B4513?text=Prosciutto+Fruit'),
                        createMenuItem('antipasti', '', 'いろいろなハムとチーズの盛合せ', '¥1,900 (2,299)', 'Assorted Various Ham & Cheese', 'イタリア各地から厳選したハムとチーズの盛り合わせ。ワインと共に。', 'A selection of hams and cheeses from various regions of Italy. Perfect with wine.', '乳', 'Dairy', 'https://placehold.co/400x200/F0F8FF/6A5ACD?text=Ham+Cheese'),
                        createMenuItem('antipasti', '', 'シェフのこだわり野菜サラダ', '¥1,600 (1,936)', 'Chef\'s Special Mixed Vegetable Salad', '契約農家から届く新鮮な野菜をふんだんに使った特製サラダ。', 'Special salad using abundant fresh vegetables from our contracted farms.', 'なし', 'None', 'https://placehold.co/400x200/C1FFDD/138B45?text=Veggie+Salad'),
                        createMenuItem('antipasti', '', 'トマトのブルスケッタ アラ ケッカ', '¥400 (532)', 'Tomato Bruschetta alla Checca', '焼きたてのガーリックブレッドに、フレッシュなトマトとバジルをたっぷり乗せて。', 'Toasted garlic bread topped generously with fresh tomatoes and basil.', '小麦', 'Wheat', 'https://placehold.co/400x200/FFDAB9/A0522D?text=Bruschetta'),

                        // パスタ・リゾット (Pasta & Risotto)
                        createMenuItem('pasta-risotto', '', 'ヤリイカのスパゲッティ', '¥2,300 (2,783)', 'Spaghetti with Fresh Squid', '新鮮なヤリイカを使った、シンプルなトマトソースのスパゲッティです。', 'Spaghetti with fresh squid in a simple tomato sauce.', '小麦、イカ', 'Wheat, Squid', 'https://placehold.co/400x200/DDC1FF/4B0082?text=Squid+Pasta'),
                        createMenuItem('pasta-risotto', '', 'パルメザンチーズのリゾット', '¥2,000 (2,420)', 'Parmesan Cheese Risotto', 'イタリア産パルミジャーノチーズを贅沢に使ったクリーミーなリゾット。', 'Creamy risotto made with generous amounts of Italian Parmesan cheese.', '乳', 'Dairy', 'https://placehold.co/400x200/B0E0E6/4682B4?text=Risotto'),
                        createMenuItem('pasta-risotto', '', 'ペンネ アラビアータ', '¥1,800 (2,178)', 'Penne with Hot Spicy Tomato Sauce', 'ピリ辛トマトソースのショートパスタ。', 'Short pasta with a spicy tomato sauce.', '小麦', 'Wheat', 'https://placehold.co/400x200/FFE4B5/8B0000?text=Penne+Arrabbiata'),
                        createMenuItem('pasta-risotto', '', 'ストラッチャテッラチーズのせ トマトソースのスパゲッティ', '¥2,000 (2,420)', 'Spaghetti with Tomato Sauce Topped with Stracciatella Cheese', 'フレッシュなトマトソースにクリーミーなストラッチャテッラチーズを添えて。', 'Spaghetti with fresh tomato sauce topped with creamy stracciatella cheese.', '乳、小麦', 'Dairy, Wheat', 'https://placehold.co/400x200/FFB6C1/8B0000?text=Stracciatella+Pasta'),
                        createMenuItem('pasta-risotto', '', 'ボローニャ風 ラザニア', '¥2,100 (2,541)', 'Lasagna Bolognese Style', 'じっくり煮込んだボロネーゼソースとベシャメルソースの伝統的なラザニア。', 'Traditional lasagna with slow-cooked Bologanese sauce and béchamel sauce.', '小麦、乳、牛肉、豚肉', 'Wheat, Dairy, Beef, Pork', 'https://placehold.co/400x200/D2B48C/5F4B3B?text=Lasagna'),
                        createMenuItem('pasta-risotto', '', '海老とポルチーニ茸のスパゲッティ', '¥2,500 (3,025)', 'Spaghetti with Shrimp & Porcini Mushroom', '海老の旨味とポルチーニ茸の香りが豊かなスパゲッティ。', 'Spaghetti rich in the flavor of shrimp and the aroma of porcini mushrooms.', '小麦、エビ', 'Wheat, Shrimp', 'https://placehold.co/400x200/FFDAB9/A0522D?text=Shrimp+Porcini+Pasta'),
                        createMenuItem('pasta-risotto', '', '神戸牛のボロネーゼ フェットチーネ', '¥2,400 (2,904)', 'Fettuccine with KOBE Beef Meat Sauce', '贅沢な神戸牛をじっくり煮込んだ、濃厚なボロネーゼソースのフェットチーネ。', 'Fettuccine with rich Bolognese sauce made from slow-cooked luxurious Kobe beef.', '小麦、乳、牛肉', 'Wheat, Dairy, Beef', 'https://placehold.co/400x200/FFFDD0/CD853F?text=Kobe+Beef+Fettuccine'),
                        createMenuItem('pasta-risotto', '', 'タラバガニとカラスミのスパゲッティ', '¥4,500 (5,445)', 'Spaghetti with King Crab "TARABAGANI" & Dried Mullet Roe "KARASUMI"', '高級食材のタラバガニとカラスミを贅沢に使った、風味豊かなスパゲッティ。', 'Fragrant spaghetti luxuriously made with high-end ingredients: king crab and dried mullet roe.', '小麦、カニ、魚卵', 'Wheat, Crab, Fish Roe', 'https://placehold.co/400x200/ADD8E6/000080?text=King+Crab+Karasumi+Pasta'),

                        // セコンド・ピアット（魚） (Main Course (Fish))
                        createMenuItem('secondi-pesce', '', '本日の鮮魚(切身)の鉄板焼', '¥2,700～ (3,267～)', 'Grilled Fish (Fillet) of the Day', 'その日仕入れた新鮮な魚の切り身を、シンプルに鉄板で焼き上げました。', 'Fresh fish fillet of the day, simply grilled on a hot plate.', '魚', 'Fish', 'https://placehold.co/400x200/A0D8E6/004080?text=Grilled+Fish+Fillet'),
                        createMenuItem('secondi-pesce', '', 'オマール海老の鉄板焼', '¥4,500 (5,445)', 'Grilled Lobster', '新鮮なオマール海老を贅沢に鉄板で焼き上げました。', 'Luxurious fresh lobster grilled on a hot plate.', 'エビ', 'Shrimp', 'https://placehold.co/400x200/FFCC99/8B4513?text=Grilled+Lobster'),
                        createMenuItem('secondi-pesce', '', '魚貝のフリット 盛合せ', '¥2,800 (3,388)', 'Assortment Fried Seafood', '新鮮な魚介を軽く衣を付けて揚げた、カリッとしたフリットの盛り合わせです。', 'A crispy assortment of fresh seafood lightly battered and fried.', '小麦、魚、イカ、エビ、貝', 'Wheat, Fish, Squid, Shrimp, Shellfish', 'https://placehold.co/400x200/E6E6FA/7B68EE?text=Fried+Seafood+Assortment'),

                        // セコンド・ピアット（肉） (Main Course (Meat))
                        createMenuItem('secondi-carne', '', '仔牛のソテー マルサラワインソース', '¥3,000 (3,630)', 'Sauteed Veal with Marsala Wine Sauce', '柔らかい仔牛をマルサラワインの芳醇なソースでソテーしました。', 'Tender veal sauteed with a rich Marsala wine sauce.', '乳、牛肉', 'Dairy, Beef', 'https://placehold.co/400x200/E0BBE4/957DAD?text=Sauteed+Veal'),
                        createMenuItem('secondi-carne', '', '仔牛のカツレツ トマト、ルッコラのせ', '¥3,000 (3,630)', 'Veal Cutlet topped with Tomato & Rucola Salad', 'サクサクの仔牛のカツレツに、フレッシュなトマトとルッコラのサラダを添えて。', 'Crispy veal cutlet topped with fresh tomato and arugula salad.', '小麦、卵、乳、牛肉', 'Wheat, Egg, Dairy, Beef', 'https://placehold.co/400x200/D8FFCC/79B37E?text=Veal+Cutlet'),
                        createMenuItem('secondi-carne', '', '国産牛のグリル', '100g ¥2,500(3,025) / 150g ¥3,500(4,235) / 200g ¥4,500(5,445) / 250g ¥5,500(6,655)', 'Grilled Japanese Beef', '厳選された国産牛をシンプルにグリルしました。お好みのグラム数で。', 'Carefully selected Japanese beef, simply grilled. Choose your preferred grams.', '牛肉', 'Beef', 'https://placehold.co/400x200/C1FFDD/138B45?text=Grilled+Beef'),
                        createMenuItem('secondi-carne', '', '国産牛のタリアータ（薄切りステーキ）サラダ添え バルサミコソース', '100g ¥2,700(3,267) / 150g ¥3,800(4,598)', 'Seared Wagyu Beef & Fresh Salad with Balsamico Sauce', '和牛を薄切りステーキにし、バルサミコソースとサラダを添えました。', 'Thinly sliced Wagyu beef steak served with balsamic sauce and salad.', '牛肉', 'Beef', 'https://placehold.co/400x200/A2D2FF/004080?text=Wagyu+Tagliata'),
                        createMenuItem('secondi-carne', '', '骨付 仔羊ロースのグリル', '¥4,900 (5,929)', 'Grilled Lamb', '骨付きの仔羊ロースを丁寧にグリルしました。', 'Carefully grilled bone-in lamb loin.', '羊肉', 'Lamb', 'https://placehold.co/400x200/F0E68C/B8860B?text=Grilled+Lamb'),
                        createMenuItem('secondi-carne', '', '牛ほほ肉の赤ワイン煮', '¥3,200 (3,872)', 'Stewed Cheek Beef in a Red Wine Sauce', '牛ほほ肉を赤ワインでじっくりと煮込み、柔らかく仕上げました。', 'Beef cheek slowly stewed in red wine until tender.', '牛肉', 'Beef', 'https://placehold.co/400x200/C0C0C0/404040?text=Stewed+Beef+Cheek'),

                        // デザート (Desserts)
                        createMenuItem('dolci-cafe', 'dessert', '季節のフルーツ ロマノフ', '¥1,000 (1,210)', 'Seasonal Fresh Fruit Romanoff', 'たっぷりのマスカルポーネチーズをお入れした生クリームと季節の美味しいフルーツでおつくりしたケーキです', 'A cake made with generous mascarpone cheese cream and delicious seasonal fruits.', '乳、卵、小麦', 'Dairy, Egg, Wheat', 'https://placehold.co/400x200/FFDDC1/8B4513?text=Seasonal+Fruit+Romanoff'),
                        createMenuItem('dolci-cafe', 'dessert', 'Topsのチョコレートケーキ', '¥850 (1,028)', 'Top\'s Chocolate Cake', 'クルミの入ったクリームでスポンジをサンド。スイスチョコレート入りのチョコレートクリームで仕上げました。', 'Sponge cake layered with walnut cream, finished with Swiss chocolate cream.', '乳、卵、小麦、クルミ', 'Dairy, Egg, Wheat, Walnuts', 'https://placehold.co/400x200/D2B48C/5F4B3B?text=Tops+Chocolate+Cake'),
                        createMenuItem('dolci-cafe', 'dessert', 'Topsのチーズケーキ', '¥850 (1,028)', 'Top\'s Cheese Cake', 'デンマーク産のクリームチーズを使った、コクのあるハードタイプのケーキです。', 'A rich, hard-type cake made with Danish cream cheese.', '乳、卵、小麦', 'Dairy, Egg, Wheat', 'https://placehold.co/400x200/F0F8FF/6A5ACD?text=Tops+Cheese+Cake'),
                        createMenuItem('dolci-cafe', 'dessert', 'ティラミス', '¥750 (907)', 'Tiramisu Cake', '「エスプレッソ」をしみ込ませたスポンジに「マスカルポーネチーズ」たっぷりのクリームを重ねたデザートです。', 'A dessert with espresso-soaked sponge cake layered with generous mascarpone cheese cream.', '乳、卵、小麦', 'Dairy, Egg, Wheat', 'https://placehold.co/400x200/D2B48C/5F4B3B?text=Tiramisu+Cake'),
                        createMenuItem('dolci-cafe', 'dessert', 'ガトーショコラ 生クリーム添え', '¥750 (907)', 'Gateau Chocolat with Fresh Cream', '濃厚なチョコレートケーキに無糖の生クリームを添えてます', 'Rich chocolate cake served with unsweetened fresh cream.', '乳、卵、小麦', 'Dairy, Egg, Wheat', 'https://placehold.co/400x200/8B4513/FFFDD0?text=Gateau+Chocolat'),
                        createMenuItem('dolci-cafe', 'dessert', '本日のタルト', '¥750 (907)', 'Tarte of the Day', '季節のタルトをご用意いたしております。スタッフにお尋ねください。', 'Seasonal tarts are available. Please ask our staff.', '乳、卵、小麦 (内容による)', 'Dairy, Egg, Wheat (varies)', 'https://placehold.co/400x200/FFDAB9/A0522D?text=Tarte+of+the+Day'),
                        createMenuItem('dolci-cafe', 'dessert', 'カスタードプリン', '¥750 (907)', 'Custard Pudding', '卵をたっぷり使ったプリンに苦みのあるカラメルソースが良く合います', 'Rich egg pudding served with a perfectly bitter caramel sauce.', '乳、卵', 'Dairy, Egg', 'https://placehold.co/400x200/FFCC99/8B4513?text=Custard+Pudding'),
                        createMenuItem('dolci-cafe', 'dessert', '本日のシャーベット', '¥750 (907)', 'Sherbet of the Day', '季節のシャーベットをご用意いたしております。スタッフにお尋ねください。', 'Seasonal sherbets are available. Please ask our staff.', 'なし (内容による)', 'None (varies)', 'https://placehold.co/400x200/ADD8E6/000080?text=Sherbet+of+the+Day'),
                        createMenuItem('dolci-cafe', 'dessert', 'プルーンの赤ワイン煮 バニラアイス添え', '¥750 (907)', 'Chilled Boiled Prune with Red Wine with Vanilla Icecream', '鉄、ミネラル、ビタミン等を多く含んでいます。バニラアイスと良く合います。', 'Rich in iron, minerals, and vitamins. Pairs well with vanilla ice cream.', '乳', 'Dairy', 'https://placehold.co/400x200/DDA0DD/800080?text=Boiled+Prune'),
                        // カフェメニュー (画像なし、説明なし)
                        createMenuItem('dolci-cafe', 'cafe', 'コーヒー（ホット または アイス）', '¥600 (726)', 'Coffee (Hot or Ice)', '', '', 'なし', 'None', ''),
                        createMenuItem('dolci-cafe', 'cafe', 'エスプレッソ', '¥600 (726)', 'Espresso Coffee', '', '', 'なし', 'None', ''),
                        createMenuItem('dolci-cafe', 'cafe', '紅 茶（ホット または アイス）', '¥600 (726)', 'Tea (Hot or Ice)', '', '', 'なし', 'None', ''),
                        createMenuItem('dolci-cafe', 'cafe', 'カプチーノ（ホット または アイス）', '¥650 (786)', 'Cappuccino Coffee (Hot or Ice)', '', '', '乳', 'Dairy', ''),
                        createMenuItem('dolci-cafe', 'cafe', 'カフェラテ（ホット または アイス）', '¥650 (786)', 'Caffelatte (Hot or Ice)', '', '', '乳', 'Dairy', ''),
                        createMenuItem('dolci-cafe', 'cafe', 'オレンジジュース', '¥600 (726)', 'Orange Juice', '', '', 'オレンジ', 'Orange', ''),
                        createMenuItem('dolci-cafe', 'cafe', 'ハーブティー カモミール', '¥600 (726)', 'Herb Tea Camomile', '', '', 'なし', 'None', ''),
                        createMenuItem('dolci-cafe', 'cafe', 'ハーブティー レモンミント', '¥600 (726)', 'Herb Tea Lemon & Mint', '', '', 'なし', 'None', ''),
                        createMenuItem('dolci-cafe', 'cafe', 'ハーブティー 森のいちご', '¥600 (726)', 'Herb Tea Wild Strawberry', '', '', 'なし', 'None', ''),
                        createMenuItem('dolci-cafe', 'cafe', 'ウーロン茶（アイス）', '¥550 (665)', 'Iced Oolong Tea', '', '', 'なし', 'None', ''),

                        // 新しいドリンクメニュー
                        // 赤ワイン (Red Wine)
                        createMenuItem('bevande', 'red-wine', 'キャンティ クラッシコ\' 22', 'グラス ¥800 (968) / デカンタ ¥3,100 (3,751) / ボトル ¥4,600 (5,566)', 'CHIANTI CLASSICO \'22 (D.O.C.G) Rocca delle Macie 【TOSCANA】/ Sangiovese 95% Merlot 5%', 'キャンティ地方の中心部だけで造られるワインです。', 'Wine made only in the central part of the Chianti region.', 'なし', 'None', 'https://placehold.co/400x200/990000/FFFFFF?text=Chianti+Classico'),
                        createMenuItem('bevande', 'red-wine', 'プリミティーヴォ ディ マンドゥーリア\'21', 'グラス ¥1,150 (1,391) / デカンタ ¥4,400 (5,324) / ボトル ¥6,600 (7,986)', 'PRIMITVO DI MANDURIA \'21 (D.O.C) Poggio Le Volpi 【LAZIO】/ Primitivo 100%', '艶のあるルビーレッド色。生き生きとしたタンニンがあり、滑らかな口当たり。', 'Glossy ruby red color. Lively tannins and a smooth texture.', 'なし', 'None', 'https://placehold.co/400x200/8B0000/FFFFFF?text=Primitivo'),
                        createMenuItem('bevande', 'red-wine', 'メルロー\'21', 'グラス ¥1,550 (1,875) / デカンタ ¥6,000 (7,260) / ボトル ¥9,000 (10,890)', 'MERLOT \'21 (I.G.P) San Marzano 【PUGLIA】/ Merlot 100%', 'ブルーベリーのアロマとカシスリキュールのような果実味。口当たりは滑らかで清涼感のあるボディ。', 'Aroma of blueberry and fruitiness like cassis liqueur. Smooth taste and refreshing body.', 'なし', 'None', 'https://placehold.co/400x200/A52A2A/FFFFFF?text=Merlot'),
                        createMenuItem('bevande', 'red-wine', 'サルパルータ ロゼ\'23', 'グラス ¥1,000 (1,210) / デカンタ ¥3,800 (4,598) / ボトル ¥5,700 (6,897)', 'SARAPARUTA ROSE \'23 (D.O.C) Duca di Salaparuta 【SICILIA】/ Frappato, others', '淡く輝きのあるロゼ色で、柑橘系の香りの中に白桃のニュアンスがある軽快な飲み口のワインです。', 'A pale, shimmering rosé color with a refreshing taste that has hints of white peach within its citrus aroma.', 'なし', 'None', 'https://placehold.co/400x200/FFC0CB/8B0000?text=Rose+Wine'),
                        createMenuItem('bevande', 'red-wine', '【微発泡】ランブルスコ レッジアーノ セッコ"コンチェルト" \'23', '¥5,500 (6,655)', 'LAMBRUSCO REGGIANO SECCO "CONCERTO" \'23 (D.O.C) Medici Ermete 【EMILIA ROMAGNA】/ Lambrusco Salamino 100%', '果実の旨味と程よいタンニンが広がる、前菜から肉料理まで相性抜群の辛口赤スパークリングです。', 'A dry red sparkling wine with rich fruit flavor and moderate tannins, perfect with appetizers to meat dishes.', 'なし', 'None', 'https://placehold.co/400x200/CD5C5C/FFFFFF?text=Lambrusco'),
                        createMenuItem('bevande', 'red-wine', 'ジゾラ \'21', '¥7,600 (9,196)', 'ZISOLA \'21 (I.G.T) Mazzei 【SICILIA】/ Nero d\'Avola 100%', '奥行きのある高い凝縮感を持ったエレガントな味わいです。', 'An elegant taste with deep, high concentration.', 'なし', 'None', 'https://placehold.co/400x200/800000/FFFFFF?text=Zisola'),
                        createMenuItem('bevande', 'red-wine', 'アル パッソ \'21', '¥8,400 (10,164)', 'AL PASSO \'21 (I.G.T) Tolaini 【TOSCANA】/ Sangiovese 85% Merlot 15%', '完熟したフルーツのアロマ。エレガントなワインです。', 'Aroma of ripe fruits. An elegant wine.', 'なし', 'None', 'https://placehold.co/400x200/B22222/FFFFFF?text=Al+Passo'),
                        createMenuItem('bevande', 'red-wine', 'モンテプルチアーノ ダブルッツォ DOC リゼルヴァ \'17', '¥9,200 (11,132)', 'MONTEPULCIANO D\'ABRUZZO DOC RISERVA \'17 (D.O.C) Terre di Poggio 【ABRUZZO】/ Montepulciano 100%', '熟した果物が濃縮感のある香りで、バランスよく調和がとれ、しっかりとしたタンニンも感じる骨格の良いワイン。', 'A well-structured wine with concentrated aroma of ripe fruits, harmoniously balanced, and firm tannins.', 'なし', 'None', 'https://placehold.co/400x200/660000/FFFFFF?text=Montepulciano'),
                        createMenuItem('bevande', 'red-wine', 'ファルニート\'18', '¥10,000 (12,100)', 'FARNITO \'18 (I.G.T) Carpineto 【TOSCANA】/ Cabernet Sauvignon 100%', 'ブラックベリーの果実味とスモーキーな樽香がバランス良く調和。 豊潤で力強い。', 'Blackberry fruitiness and smoky barrel aroma are well balanced. Rich and powerful.', 'なし', 'None', 'https://placehold.co/400x200/4B0000/FFFFFF?text=Farnito'),
                        createMenuItem('bevande', 'red-wine', 'ブルネッロ ディ モンタルチーノ \'18', '¥15,000 (18,150)', 'BRUNELLO DI MONTALCINO \'18 (D.O.C.G) Centolani 【TOSCANA】/ Sangiovese Grosso 100%', 'ピロードのようなタンニンとまろやかで柔らかな、ストラクチャーのフルボディで土壌由来のミネラルと、樽由来の杉とタバコのアロマが感じられます。', 'A full-bodied wine with velvety tannins and a mellow, soft structure, with aromas of soil-derived minerals, and cedar and tobacco from the barrel.', 'なし', 'None', 'https://placehold.co/400x200/8A0303/FFFFFF?text=Brunello'),
                        createMenuItem('bevande', 'red-wine', 'バローロ \'13', '¥15,000 (18,150)', 'BAROLO \'13 (D.O.C.G) Nicolello 【PIEMONTE】/ Nebbiolo 100%', 'ワインの王様「バローロ」。深みのあるガーネット色にオレンジがかったエッジで、エレガントで力強いワインです。', 'The King of Wines "Barolo". Deep garnet color with an orange tinge on the edge, an elegant and powerful wine.', 'なし', 'None', 'https://placehold.co/400x200/5C0000/FFFFFF?text=Barolo'),

                        // 白ワイン (White Wine)
                        createMenuItem('bevande', 'white-wine', 'マンドーロ オルヴィエート クラッシコ\' 23', 'グラス ¥800 (968) / デカンタ ¥3,100 (3,751) / ボトル ¥4,600 (5,566)', 'MANDORLO ORVIETO CLASSICO \'23 (D.O.C) Rocca delle Macie 【UMBRIA】/ Trebbiano 50% others', 'すっきりしたのどごしで、繊細な味のオルヴィエートです。', 'A delicate Orvieto with a refreshing finish.', 'なし', 'None', 'https://placehold.co/400x200/F0F8FF/6A5ACD?text=Orvieto+Classico'),
                        createMenuItem('bevande', 'white-wine', 'ヴィン ソアベ クラシコ \'21', 'グラス ¥1,050 (1,270) / デカンタ ¥4,000 (4,840) / ボトル ¥6,000 (7,260)', 'VIN SOAVE CLASSICO \'21 (D.O.C) Inama【VENETO】/ Garganega 100%', '透き通った黄色。カモミールやアイリスなどの甘い香りで、余韻にはアーモンドの風味があります。', 'Clear yellow. Sweet aromas of chamomile and iris, with an an almond finish.', 'なし', 'None', 'https://placehold.co/400x200/F5DEB3/8B4513?text=Soave+Classico'),
                        createMenuItem('bevande', 'white-wine', 'ソーヴィニヨン プライル アルト アディジェ\'23', 'グラス ¥1,550 (1,876) / デカンタ ¥6,000 (7,260) / ボトル ¥9,000 (10,890)', 'SAUVIGNON PRAIL ALTO ADIGE DOC \'23 (D.O.C) Colterenzio 【Trentino Alto Adige】/ Sauvignon Blanc 100%', '緑がかった明るい黄色。余韻にミネラルを感じるフレッシュな味わい。「プライル」は畑の名前。', 'Bright yellow with a greenish tint. Fresh taste with a mineral finish. "Prail" is the name of the vineyard.', 'なし', 'None', 'https://placehold.co/400x200/E0FFFF/4682B4?text=Sauvignon+Prail'),
                        createMenuItem('bevande', 'white-wine', 'ヴィラ・ヴェスコヴィレ ピノ・グリージョ\'22', '¥6,000 (7,260)', 'VILLA VESCOVILE PINOT GRIGIO \'22 (D.O.C) Villa Vescovile【Trentino-Aloto Adige 】/ Pinot Grigio 100% others', 'フレッシュな果実とアーモンドの香り。程よい酸味とボリューム感があります。', 'Aroma of fresh fruit and almond. Balanced acidity and volume.', 'なし', 'None', 'https://placehold.co/400x200/FAFAD2/B8860B?text=Pinot+Grigio'),
                        createMenuItem('bevande', 'white-wine', '【甘口】モスカート ダスティ \'22', '¥6,700 (8,107)', 'MOSCATO D\'ASTI \'22 (D.O.C) Ceretto 【PIEMONTE】/ Moscato 100%', '微炭酸でアルコール度数も低く（5～6％）、ほのかな甘味のある味わいは女性に大人気です。', 'Slightly sparkling with low alcohol content (5-6%), its subtle sweet taste is very popular with women.', 'なし', 'None', 'https://placehold.co/400x200/FFDAB9/A0522D?text=Moscato+d\'Asti'),
                        createMenuItem('bevande', 'white-wine', 'ガヴィ デル コムーネ ディ ガヴィ \'23', '¥7,000 (8,470)', 'GAVI DEL COMUNE DI GAVI \'23 (D.O.C.G) Villa Sparina 【PIEMONTE】/ Cortese 100%', 'きりっとした酸味と爽やかな果実味とのバランスが良くとれたワインです。', 'A well-balanced wine with crisp acidity and refreshing fruitiness.', 'なし', 'None', 'https://placehold.co/400x200/ADD8E6/4682B4?text=Gavi'),
                        createMenuItem('bevande', 'white-wine', 'ピエモンテ シャルドネ バリック\'22', '¥7,800 (9,438)', 'PIEMONTE CHARDONNAY FILEBSSE \'22 (D.O.C) Viverti Giovani 【PIEMONTE】/ Chardonnay 100%', 'バナナ、リンゴ、トロピカルフルーツのアロマにアカシアの花のニュアンス。柔らかな飲み口。フレッシュな酸味とのバランスに優れた味わい。', 'Aroma of banana, apple, tropical fruits with nuances of acacia flowers. Soft on the palate. A taste with an excellent balance of fresh acidity.', 'なし', 'None', 'https://placehold.co/400x200/F8F8FF/6A5ACD?text=Piemonte+Chardonnay'),
                        createMenuItem('bevande', 'white-wine', 'アルターレ\'22', '¥9,600 (11,616)', 'ALTARE \'22 (D.O.C) Marramiero 【ABRUZZO】/ Trebbiano 100%', '果実の凝縮度が高く、クリーミーでふくよかな果実味を滑らかな酸がバランスよく支えるワインです。', 'A wine with high fruit concentration, creamy and rich fruitiness balanced by smooth acidity.', 'なし', 'None', 'https://placehold.co/400x200/DCDCDC/808080?text=Altare'),
                        createMenuItem('bevande', 'white-wine', 'プラネタ シャルドネ\'22', '¥20,000 (24,200)', 'PLANETA CHARDONNAY \'22 (I.G.T) Planeta 【SICILIA】/ Chardonnay 100%', 'シチリア産シャルドネ特有の大変芳醇で温かみのある力強いワインです。', 'A very rich, warm, and powerful wine characteristic of Sicilian Chardonnay.', 'なし', 'None', 'https://placehold.co/400x200/FFEC8B/CD853F?text=Planeta+Chardonnay'),

                        // スパークリングワイン (Sparkling Wine)
                        createMenuItem('bevande', 'sparkling-wine', 'スペローネ スプマンテ キュヴェ ブリュット', 'グラス ¥850 (1,028) / デカンタ ¥4,900 (5,929)', 'SPERONE SPUMANTE CUVEE BRUT (D.O.C) Sperone 【PIEMONTE】/ Chardonnay 75% Trebbiano 25%', '', '', 'なし', 'None', 'https://placehold.co/400x200/FFC0CB/8B0000?text=Sparkling+Wine'),
                        createMenuItem('bevande', 'sparkling-wine', 'フランチャコルタ ブリュット', 'ボトル ¥8,000 (9,680)', 'FRANCIACORTA BRUT (D.O.C.G) Contadi Castaldi 【LOMBARDIA】 / Chardonnay 80% Pinot Nero 10% Bianco 10%', '', '', 'なし', 'None', 'https://placehold.co/400x200/E6E6FA/7B68EE?text=Franciacorta+Brut'),

                        // 食前酒 (Aperitif)
                        createMenuItem('bevande', 'aperitif', '生ビール（アサヒ スーパードライ）', '¥800 (968)', 'Draft Beer (ASAHI SUPER DRY)', '', '', '小麦', 'Wheat', ''),
                        createMenuItem('bevande', 'aperitif', 'チンザノ', '¥700 (847)', 'CINZANO (Dry or Sweet)', '〈ドライ 又はスウィート〉', '(Dry or Sweet)', 'なし', 'None', ''),
                        createMenuItem('bevande', 'aperitif', 'ペローニ ナストロ アズーロ', '¥850 (1,028)', 'PERONI NASTRO AZZURRO', '', '', '小麦', 'Wheat', ''),
                        createMenuItem('bevande', 'aperitif', 'カンパリソーダ', '¥750 (907)', 'CAMPARI Soda', '', '', 'なし', 'None', ''),
                        createMenuItem('bevande', 'aperitif', '小瓶ビール', '¥700 (847)', 'Bottle Beer (KIRIN or ASAHI)', '', '', '小麦', 'Wheat', ''),
                        createMenuItem('bevande', 'aperitif', 'カンパリオレンジ', '¥800 (968)', 'CAMPARI & Orange', '', '', 'オレンジ', 'Orange', ''),
                        createMenuItem('bevande', 'aperitif', 'ドライシェリー', '¥700 (847)', 'Dry Sherry', '', '', 'なし', 'None', ''),
                        createMenuItem('bevande', 'aperitif', 'ジントニック', '¥750 (907)', 'Gin & Tonic', '', '', 'なし', 'None', ''),
                        createMenuItem('bevande', 'aperitif', 'キール', '¥750 (907)', 'Kir', '〈白ワイン ＆ カシス〉', '(White Wine & Cassis)', 'なし', 'None', ''),
                        createMenuItem('bevande', 'aperitif', 'ミモザ', '¥800 (968)', 'Mimoza', '〈スパークリングワイン ＆ オレンジジュース〉', '(Sparkling Wine & Orange Juice)', 'オレンジ', 'Orange', ''),
                        createMenuItem('bevande', 'aperitif', 'キールロワイヤル', '¥800 (968)', 'Kir Royal', '〈スパークリングワイン ＆ カシス〉', '(Sparkling Wine & Cassis)', 'なし', 'None', ''),
                        createMenuItem('bevande', 'aperitif', 'ベリーニ', '¥800 (968)', 'Bellini', '〈スパークリングワイン ＆ ピーチネクター〉', '(Sparkling Wine & Peach Nectar)', 'モモ', 'Peach', ''),
                        createMenuItem('bevande', 'aperitif', 'カシス ソーダ', '¥750 (907)', 'Cassis & Soda,Orange Juice or Oolong Tea', '〈ソーダ、オレンジジュース 又は ウーロン茶〉', '(Soda, Orange Juice or Oolong Tea)', 'オレンジ', 'Orange', ''),
                        createMenuItem('bevande', 'aperitif', 'ネグローニ', '¥750 (907)', 'Negroni', '〈ジン、カンパリ ＆ スウィートベルモット〉', '(Gin, Campari & Sweet Vermouth)', 'なし', 'None', ''),
                        createMenuItem('bevande', 'aperitif', 'スクリュ－ドライバー', '¥750 (907)', 'Screwdriver', '〈ウォッカ ＆ オレンジジュース〉', '(Vodka & Orange Juice)', 'オレンジ', 'Orange', ''),
                        createMenuItem('bevande', 'aperitif', 'シチリアーノ', '¥750 (907)', 'Siciliano', '〈赤ワイン、アマレット ＆ トニックウォーター〉', '(Red Wine, Amaretto & Tonic Water)', 'なし', 'None', ''),
                        createMenuItem('bevande', 'aperitif', 'マティーニ', '¥700 (847)', 'Matini', '〈ジン ＆ ベルモット〉', '(Gin & Vermouth)', 'なし', 'None', ''),

                        // ウィスキー (Whisky)
                        createMenuItem('bevande', 'whisky', 'シーバス リーガル', '¥750 (907)', 'CHIVAS REAGAL', '', '', 'なし', 'None', ''),
                        createMenuItem('bevande', 'whisky', 'バランタイン', '¥1,500 (1,815)', 'Ballantines', '', '', 'なし', 'None', ''),
                        createMenuItem('bevande', 'whisky', 'ネーヴィス デュー', '¥750 (907)', 'NEVIS DEW', '', '', 'なし', 'None', ''),
                        createMenuItem('bevande', 'whisky', 'ＩＷ ハーパー', '¥750 (907)', 'IW HARPER', '', '', 'なし', 'None', ''),

                        // 食後酒 (Digestivo)
                        createMenuItem('bevande', 'digestivo', 'グラッパ', '¥800～ (968～)', 'GRAPPA', '', '', 'なし', 'None', ''),
                        createMenuItem('bevande', 'digestivo', '自家製 リモンチェッロ', '¥800 (968)', 'LIMONCELLO', '', '', 'なし', 'None', ''),
                        createMenuItem('bevande', 'digestivo', 'フランジェリコ', '¥800 (968)', 'FRANGELICO', 'ヘーゼルナッツのリキュール酒', 'Hazelnut liqueur', 'なし', 'None', ''),
                        createMenuItem('bevande', 'digestivo', 'ノチェッロ', '¥800 (968)', 'NOCELLO', 'クルミのリキュール酒', 'Walnut liqueur', 'クルミ', 'Walnut', ''),
                        createMenuItem('bevande', 'digestivo', 'アベルナ アマーロ', '¥800 (968)', 'AVERNA AMARO', 'シチリア島の薬草酒', 'Sicilian herbal liqueur', 'なし', 'None', ''),
                        createMenuItem('bevande', 'digestivo', 'パッシート パンテレッリア', '¥800 (968)', 'PASSITO PANTELLERIA', 'シチリアのデザートワイン', 'なし', 'None', ''),

                        // ノンアルコールワイン (Non Alcohol Wine) - 画像なし、説明なし
                        createMenuItem('bevande', 'non-alcohol-wine', 'スパークリングワイン', '¥1,200 (1,452)', 'Sparkling Wine', '', '', 'なし', 'None', ''),
                        createMenuItem('bevande', 'non-alcohol-wine', 'シャルドネ', '¥1,200 (1,452)', 'Chardonnay', '〈白ワイン〉', '(White Wine)', 'なし', 'None', ''),
                        createMenuItem('bevande', 'non-alcohol-wine', 'メルロー', '¥1,200 (1,452)', 'Merlot', '〈赤ワイン〉', '(Red Wine)', 'なし', 'None', ''),

                        // ソフトドリンク (Soft Drink) - 画像なし、説明なし
                        createMenuItem('bevande', 'soft-drink', 'ザクロ ＆ エルダーフラワー ジュース', '¥1,000 (1,210)', 'bottlegreen(Pomegranate & Elder flower)', '', '', 'なし', 'None', ''),
                        createMenuItem('bevande', 'soft-drink', 'コカコーラ', '¥550 (665)', 'Coca Cola', '', '', 'なし', 'None', ''),
                        createMenuItem('bevande', 'soft-drink', 'ノンアルコールビール（小瓶）', '¥650 (787)', 'Non Alcohol Beer', '', '', '小麦', 'Wheat', ''),
                        createMenuItem('bevande', 'soft-drink', 'コカコーラゼロ', '¥550 (665)', 'Coca Cola Zero', '', '', 'なし', 'None', ''),
                        createMenuItem('bevande', 'soft-drink', 'サンペレグリーノ', '（500ml）¥700 (847) / （1,000ml）¥900 (1,089)', 'S. PELLEGRINO', '（ガス入り ミネラルウォーター）', '(Sparkling Mineral Water)', 'なし', 'None', ''),
                        createMenuItem('bevande', 'soft-drink', 'パンナ', '（500ml）¥700 (847) / （1,000ml）¥900 (1,089)', 'PANNA', '（ミネラルウォーター）', '(Mineral Water)', 'なし', 'None', ''),
                        createMenuItem('bevande', 'soft-drink', 'ジンジャーエール', '¥550 (665)', 'Ginger Ale', '', '', 'なし', 'None', ''),
                        createMenuItem('bevande', 'soft-drink', 'ウーロン茶', '¥550 (665)', 'Oolong Tea', '', '', 'なし', 'None', ''),
                        createMenuItem('bevande', 'soft-drink', 'リンゴジュース', '¥500 (605)', 'Apple Juice', '', '', 'りんご', 'Apple', ''),
                        createMenuItem('bevande', 'soft-drink', 'オレンジジュース', '¥600 (726)', 'Orange Juice', '', '', 'オレンジ', 'Orange', ''),
                        createMenuItem('bevande', 'soft-drink', 'トマトジュース', '¥500 (605)', 'Tomato Juice', '', '', 'なし', 'None', ''),


                        // 非公開アイテム（テスト用）
                        createMenuItem('secondi-carne', '', '【非公開】テストスペシャルミート', '¥9,999 (12,098)', '[Private] Test Special Meat', '管理者モードでのみ表示されるテスト用の非公開肉料理です。', 'This is a private test meat dish visible only in admin mode.', '管理者確認', 'Admin Check', 'https://placehold.co/400x200/FF0000/FFFFFF?text=Private+Item', false)
                    ];

                    for (const item of sampleItems) {
                        const newDocRef = doc(publicMenuCollectionRef); // 新しいドキュメント参照を生成
                        batch.set(newDocRef, item); // バッチにセット操作を追加
                    }
                    await batch.commit(); // バッチをコミット
                    console.log("Firestore: Sample data populated via batch write.");
                } else {
                    console.log("Firestore: Public menu collection is not empty. Skipping sample data population.");
                }
            };

            populateSampleData(); // サンプルデータ投入を試行

            // データのリアルタイム購読を開始（今回はパブリックコレクション）
            unsubscribeFirestore = onSnapshot(publicMenuCollectionRef, (snapshot) => {
                const items = snapshot.docs.map(doc => {
                    const data = doc.data();
                    // Default Type for dolci-cafe items if not explicitly set
                    if (data.Category === 'dolci-cafe' && !data.Type) {
                        data.Type = 'dessert';
                    }
                    // Default Type for bevande items if not explicitly set
                    if (data.Category === 'bevande' && !data.Type) {
                        // Find the first valid Type from DRINK_SUB_CATEGORIES if not set
                        data.Type = DRINK_SUB_CATEGORIES[0]?.key || '';
                    }
                    return {
                        id: doc.id,
                        ...data
                    };
                });
                setMenuItems(items);
                setIsLoading(false);
                console.log("Firestore: Menu data fetched successfully from public collection.");
                if (items.length === 0) {
                    showAndHideMessage(UI_TEXTS['no_data_found'][currentLanguage], 'info', 5000);
                }
            }, (error) => {
                console.error("Firestore: Error fetching data from public collection:", error);
                setIsLoading(false);
                showAndHideMessage(`${UI_TEXTS['error_fetching_data'][currentLanguage]} ${error.message}`, 'error', 10000);
            });
        }

        return () => {
            if (unsubscribeFirestore) {
                unsubscribeFirestore(); // Firestore snapshot listenerをクリーンアップ
            }
            if (messageTimeoutRef.current) {
                clearTimeout(messageTimeoutRef.current);
            }
        };
    }, [isAuthReady, currentLanguage, showAndHideMessage]); // isAuthReadyがtrueになったら再実行

    // Firebaseの価格変換ヘルパー (サンプルデータ生成用)
    const convertJpPriceToEnDisplay = (jpPriceString) => {
        // Multi-part prices (e.g.,グラス/デカンタ/ボトル)
        if (jpPriceString.includes(' / ')) {
            return jpPriceString.split(' / ').map(part => {
                const glassMatch = part.match(/(グラス|デカンタ|ボトル)\s*\u00A5([\d,]+)\s*\(([\d,]+)\)/);
                if (glassMatch) {
                    const type = glassMatch[1].trim();
                    const exclTaxJp = parseInt(glassMatch[2].replace(/,/g, ''), 10);
                    const inclTaxJp = parseInt(glassMatch[3].replace(/,/g, ''), 10);
                    const exclTaxEn = (exclTaxJp / 110).toFixed(2);
                    const inclTaxEn = (inclTaxJp / 110).toFixed(2);

                    let typeEn = type;
                    if (type === 'グラス') typeEn = 'Glass';
                    if (type === 'デカンタ') typeEn = 'Decanter';
                    if (type === 'ボトル') typeEn = 'Bottle';
                    return `${typeEn} $${exclTaxEn} (Tax incl. $${inclTaxEn})`;
                }
                const mlMatch = part.match(/（(\d+)ml）\u00A5([\d,]+)\s*\(([\d,]+)\)/);
                 if (mlMatch) {
                    const ml = mlMatch[1];
                    const exclTaxJp = parseInt(mlMatch[2].replace(/,/g, ''), 10);
                    const inclTaxJp = parseInt(mlMatch[3].replace(/,/g, ''), 10);
                    const exclTaxEn = (exclTaxJp / 110).toFixed(2);
                    const inclTaxEn = (inclTaxJp / 110).toFixed(2);
                    return `(${ml}ml) $${exclTaxEn} (Tax incl. $${inclTaxEn})`;
                }
                const gramMatch = part.match(/(\d+)g\s*\u00A5([\d,]+)\s*\(([\d,]+)\)/);
                if (gramMatch) {
                    const gram = gramMatch[1];
                    const exclTaxJp = parseInt(gramMatch[2].replace(/,/g, ''), 10);
                    const inclTaxJp = parseInt(gramMatch[3].replace(/,/g, ''), 10);
                    const exclTaxEn = (exclTaxJp / 110).toFixed(2);
                    const inclTaxEn = (inclTaxJp / 110).toFixed(2);
                    return `${gram}g $${exclTaxEn} (Tax incl. $${inclTaxEn})`;
                }
                return part; // Fallback for unmatched parts like "100g..."
            }).join(' / ');
        }

        // Simple prices (e.g., ¥X (Y) or ¥X)
        const regexWithTax = /\u00A5([\d,]+)\s*\(([\d,]+)\)/;
        const regexWithoutTax = /\u00A5([\d,]+)～?/;

        const matchWithTax = jpPriceString.match(regexWithTax);
        if (matchWithTax) {
            const exclTaxJp = parseInt(matchWithTax[1].replace(/,/g, ''), 10);
            const inclTaxJp = parseInt(matchWithTax[2].replace(/,/g, ''), 10);
            const exclTaxEn = (exclTaxJp / 110).toFixed(2);
            const inclTaxEn = (inclTaxJp / 110).toFixed(2);
            return `$${exclTaxEn} (Tax incl. $${inclTaxEn})`;
        } else {
            const matchWithoutTax = jpPriceString.match(regexWithoutTax);
            if (matchWithoutTax) {
                const exclTaxJp = parseInt(matchWithoutTax[1].replace(/,/g, ''), 10);
                const exclTaxEn = (exclTaxJp / 110).toFixed(2);
                const inclTaxEn = ((exclTaxJp * 1.10) / 110).toFixed(2);
                let result = `$${exclTaxEn}`;
                if (jpPriceString.includes('～')) {
                    result = `From $${exclTaxEn}`;
                }
                if (inclTaxEn && !jpPriceString.includes('～')) {
                    result += ` (Tax incl. $${inclTaxEn})`;
                } else if (jpPriceString.includes('～')) {
                    result += ` (Tax incl. $${inclTaxEn}~)`;
                }
                return result;
            }
        }
        return jpPriceString; // Fallback for complex strings not covered
    };


    // ヘルパー関数: メニューアイテムを作成
    const createMenuItem = (category, type, jpName, jpPriceDisplay, enName, jpDesc, enDesc, jpAllergens, enAllergens, imageUrl, isPublic = true) => {
        const enPriceDisplay = enName && jpPriceDisplay ? convertJpPriceToEnDisplay(jpPriceDisplay) : jpPriceDisplay; // JP価格からEN価格を生成
        return {
            Category: category,
            Type: type,
            Name_jp: jpName,
            Name_en: enName || jpName,
            Description_jp: jpDesc || UI_TEXTS['no_description']['jp'],
            Description_en: enDesc || UI_TEXTS['no_description']['en'],
            PriceDisplay_jp: jpPriceDisplay,
            PriceDisplay_en: enPriceDisplay,
            Allergens_jp: jpAllergens || UI_TEXTS['no_allergens']['jp'],
            Allergens_en: enAllergens || UI_TEXTS['no_allergens']['en'],
            ImageUrl: imageUrl || '',
            IsPublic: isPublic
        };
    };

    // 管理者ログイン処理
    const handleAdminLogin = async (e) => {
        e.preventDefault();
        setAdminLoginError(null);
        setIsLoggingIn(true);
        try {
            await signInWithEmailAndPassword(auth, adminEmail, adminPassword);
            showAndHideMessage(UI_TEXTS['admin_logged_in_message'][currentLanguage], 'success');
            // onAuthStateChanged が発火し、isAdminUser が更新される
        } catch (error) {
            console.error("Admin Login Error:", error);
            if (error.code === 'auth/invalid-email' || error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                setAdminLoginError(UI_TEXTS['login_error_invalid_credentials'][currentLanguage]);
            } else if (error.code === 'auth/too-many-requests') {
                setAdminLoginError(UI_TEXTS['login_error_too_many_requests'][currentLanguage]);
            } else {
                setAdminLoginError(`${UI_TEXTS['login_error_generic'][currentLanguage]} ${error.message}`);
            }
        } finally {
            setIsLoggingIn(false);
        }
    };

    // 管理者ログアウト処理
    const handleAdminLogout = async () => {
        try {
            await signOut(auth);
            setAdminEmail('');
            setAdminPassword('');
            setIsAdminMode(false); // ログアウトしたら管理者モードをオフに
            showAndHideMessage('ログアウトしました。', 'info');
        } catch (error) {
            console.error("Logout Error:", error);
            showAndHideMessage(`ログアウトに失敗しました: ${error.message}`, 'error');
        }
    };

    // メニュー項目追加/編集処理
    const handleSaveItem = async (itemData) => {
        setIsLoading(true);
        try {
            // PriceDisplay_en を PriceDisplay_jp から自動生成
            const finalItemData = {
                ...itemData,
                PriceDisplay_en: convertJpPriceToEnDisplay(itemData.PriceDisplay_jp)
            };

            // パブリックコレクションへの参照
            const publicMenuCollectionRef = collection(db, `artifacts/${appId}/public/data/menu`);
            if (finalItemData.id) {
                // 編集
                await setDoc(doc(publicMenuCollectionRef, finalItemData.id), finalItemData);
                showAndHideMessage("メニュー項目が更新されました！", 'success');
                console.log("Firestore: Item updated:", finalItemData.id);
            } else {
                // 新規追加
                await addDoc(publicMenuCollectionRef, finalItemData);
                showAndHideMessage("新しいメニュー項目が追加されました！", 'success');
                console.log("Firestore: New item added.");
            }
        } catch (e) {
            showAndHideMessage(`保存中にエラーが発生しました: ${e.message}`, 'error');
            console.error("Firestore: Error adding/updating document: ", e);
        } finally {
            setIsLoading(false);
        }
    };

    // メニュー項目削除処理
    const handleDeleteItem = async () => {
        setIsLoading(true);
        setShowConfirmModal(false); // 確認モーダルを閉じる
        if (!itemToDelete) return;

        try {
            // パブリックコレクションからの削除
            const menuDocRef = doc(db, `artifacts/${appId}/public/data/menu`, itemToDelete.id);
            await deleteDoc(menuDocRef);
            showAndHideMessage("メニュー項目が削除されました！", 'success');
            console.log("Firestore: Item deleted:", itemToDelete.id);
            setItemToDelete(null); // 削除対象をクリア
        } catch (e) {
            showAndHideMessage(`削除中にエラーが発生しました: ${e.message}`, 'error');
            console.error("Firestore: Error removing document: ", e);
        } finally {
            setIsLoading(false);
        }
    };

    // カテゴリ別にメニューをフィルタリング
    const filteredMenuItems = menuItems.filter(item => {
        const matchesCategory = item.Category === selectedCategory;
        // 管理者モードの場合、公開/非公開に関わらず全て表示。非管理者モードの場合は公開アイテムのみ表示。
        const isVisible = isAdminMode || (item.IsPublic === true);
        return matchesCategory && isVisible;
    });

    // デザート・カフェカテゴリの場合の特別なフィルタリング
    const dessertItems = filteredMenuItems.filter(item => item.Category === 'dolci-cafe' && (item.Type === 'dessert' || !item.Type));
    const cafeItems = filteredMenuItems.filter(item => item.Category === 'dolci-cafe' && item.Type === 'cafe');

    // 価格表示のフォーマット関数
    const formatPriceDisplay = (priceString, lang) => {
        if (!priceString) return null;
        // " / " で分割し、各部分を新しい行でレンダリング
        return priceString.split(' / ').map((part, index) => (
            <span key={index} className="block leading-tight">
                {part}
            </span>
        ));
    };


    return (
        <div className="min-h-screen bg-gradient-to-br from-gray-100 to-gray-200 text-gray-800 font-inter p-4 sm:p-6 lg:p-8">
            <style>
                {`
                @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;700&display=swap');
                .font-playfair {
                    font-family: 'Playfair Display', serif;
                }
                .font-inter {
                    font-family: 'Inter', sans-serif;
                }
                .animate-fade-in {
                    animation: fadeIn 0.3s ease-out forwards;
                }
                .animate-scale-in {
                    animation: scaleIn 0.3s ease-out forwards;
                }
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes scaleIn {
                    from { transform: scale(0.95); opacity: 0; }
                    to { transform: scale(1); opacity: 1; }
                }

                /* Custom Toggle Switch */
                .toggle-switch {
                    appearance: none;
                    width: 40px;
                    height: 20px;
                    border-radius: 10px;
                    background-color: #cbd5e0; /* gray-300 */
                    outline: none;
                    cursor: pointer;
                    position: relative;
                    transition: background-color 0.3s ease;
                }

                .toggle-switch::before {
                    content: '';
                    position: absolute;
                    top: 2px;
                    left: 2px;
                    width: 16px;
                    height: 16px;
                    border-radius: 50%;
                    background-color: #ffffff;
                    transition: transform 0.3s ease, background-color 0.3s ease;
                }

                .toggle-switch:checked {
                    background-color: #dc2626; /* red-600 */
                }

                .toggle-switch:checked::before {
                    transform: translateX(20px);
                    background-color: #ffffff;
                }
                `}
            </style>
            <div className="max-w-4xl mx-auto bg-white rounded-xl shadow-2xl overflow-hidden">
                {/* ヘッダー */}
                <header className="bg-gradient-to-r from-red-800 to-red-600 text-white p-6 sm:p-8 text-center rounded-t-xl relative">
                    <div className="flex justify-between items-center mb-4">
                        <h1 className="font-playfair text-4xl sm:text-5xl font-bold leading-tight tracking-wider">
                            LA GRANATA
                        </h1>
                        <div className="flex items-center space-x-3">
                             <div className="relative inline-block text-left">
                                <button
                                    onClick={() => setCurrentLanguage(currentLanguage === 'jp' ? 'en' : 'jp')}
                                    className="p-2 rounded-full bg-red-700 hover:bg-red-900 transition-colors duration-200 shadow-lg text-sm font-semibold"
                                    aria-label={currentLanguage === 'jp' ? 'Change to English' : '日本語に変更'}
                                >
                                    {currentLanguage === 'jp' ? 'EN' : 'JP'}
                                </button>
                            </div>
                            <div className="flex items-center space-x-2 bg-red-700 p-2 rounded-full shadow-lg">
                                <User className="w-5 h-5 text-white" />
                                <span className="text-sm font-semibold truncate max-w-[80px] sm:max-w-[120px]">
                                    {userId === 'ゲスト' ? 'ゲスト' : userId.substring(0, 8) + '...'}
                                </span>
                            </div>
                        </div>
                    </div>
                    <p className="text-red-100 text-lg sm:text-xl italic">
                        {currentLanguage === 'jp' ? '本場イタリアの味を、心を込めて。' : 'Authentic Italian flavors, made with passion.'}
                    </p>
                    <div className="mt-4 flex items-center justify-center space-x-3">
                        <label htmlFor="admin-toggle" className="text-white text-md cursor-pointer select-none">
                            {UI_TEXTS['admin_mode'][currentLanguage]}
                        </label>
                        {/* 管理者モードトグルは、実際の管理者がログインしている場合にのみ操作可能 */}
                        <input
                            type="checkbox"
                            id="admin-toggle"
                            checked={isAdminMode}
                            onChange={() => setIsAdminMode(!isAdminMode)}
                            className="toggle-switch cursor-pointer"
                            disabled={!isAdminUser} // 管理者ユーザーでないと無効
                        />
                    </div>
                </header>

                {/* メッセージ表示エリア */}
                {message && <MessageDisplay message={message} type={messageType} currentLanguage={currentLanguage} />}

                {/* 管理者ログイン/ログアウトUI */}
                {isAdminUser ? (
                    <div className="p-4 sm:p-6 bg-red-100 border-b border-red-200 text-center">
                        <p className="text-lg text-red-800 font-semibold mb-3">
                            {UI_TEXTS['admin_logged_in_message'][currentLanguage]}
                        </p>
                        <button
                            onClick={handleAdminLogout}
                            className="px-6 py-2 bg-red-600 text-white rounded-full shadow-md hover:bg-red-700 transition-colors duration-200 text-sm font-semibold"
                        >
                            {UI_TEXTS['admin_logout_button'][currentLanguage]}
                        </button>
                    </div>
                ) : (
                    <div className="p-4 sm:p-6 bg-red-100 border-b border-red-200">
                        <h2 className="text-xl font-bold text-gray-800 mb-4 text-center">{UI_TEXTS['admin_login_title'][currentLanguage]}</h2>
                        <form onSubmit={handleAdminLogin} className="space-y-4 max-w-sm mx-auto">
                            {adminLoginError && (
                                <p className="text-red-600 text-sm bg-red-100 border border-red-300 p-2 rounded-md text-center">
                                    {adminLoginError}
                                </p>
                            )}
                            <div>
                                <label htmlFor="admin-email" className="block text-sm font-medium text-gray-700 mb-1">
                                    {UI_TEXTS['admin_email_label'][currentLanguage]}
                                </label>
                                <input
                                    type="email"
                                    id="admin-email"
                                    value={adminEmail}
                                    onChange={(e) => setAdminEmail(e.target.value)}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500"
                                    required
                                    disabled={isLoggingIn}
                                />
                            </div>
                            <div>
                                <label htmlFor="admin-password" className="block text-sm font-medium text-gray-700 mb-1">
                                    {UI_TEXTS['admin_password_label'][currentLanguage]}
                                </label>
                                <input
                                    type="password"
                                    id="admin-password"
                                    value={adminPassword}
                                    onChange={(e) => setAdminPassword(e.target.value)}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500"
                                    required
                                    disabled={isLoggingIn}
                                />
                            </div>
                            <button
                                type="submit"
                                className="w-full px-6 py-2 bg-red-600 text-white rounded-md shadow-md hover:bg-red-700 transition-colors duration-200 text-lg font-semibold"
                                disabled={isLoggingIn}
                            >
                                {isLoggingIn ? `${UI_TEXTS['loading_data'][currentLanguage]}...` : UI_TEXTS['admin_login_button'][currentLanguage]}
                            </button>
                        </form>
                    </div>
                )}


                {/* カテゴリナビゲーション */}
                <nav className="p-4 sm:p-6 bg-red-50 border-b border-red-200">
                    <div className="flex flex-wrap justify-center gap-3 sm:gap-4">
                        {ALL_CATEGORIES.map(category => (
                            <button
                                key={category.key}
                                onClick={() => setSelectedCategory(category.key)}
                                className={`flex flex-col items-center justify-center p-3 sm:p-4 rounded-lg transition-all duration-300 ease-in-out
                                            text-sm sm:text-base font-medium min-w-[80px] sm:min-w-[100px] h-24 sm:h-28 text-center
                                            ${selectedCategory === category.key
                                                ? 'bg-red-700 text-white shadow-md transform scale-105'
                                                : 'bg-white text-red-700 border border-red-300 hover:bg-red-100 hover:shadow-sm'
                                            }`}
                            >
                                <category.icon className={`w-8 h-8 sm:w-10 sm:h-10 mb-1 ${selectedCategory === category.key ? 'text-white' : 'text-red-600'}`} />
                                <span>{category[currentLanguage]}</span>
                            </button>
                        ))}
                    </div>
                </nav>

                {/* メニューリスト */}
                <main className="p-4 sm:p-6 bg-white min-h-[400px] relative">
                    {isLoading ? (
                        <div className="flex flex-col items-center justify-center h-full absolute inset-0">
                            <Loader2 className="w-12 h-12 text-red-500 animate-spin" />
                            <p className="mt-4 text-lg text-gray-600">{UI_TEXTS['loading_data'][currentLanguage]}</p>
                        </div>
                    ) : (
                        <>
                            <h2 className="font-playfair text-3xl font-semibold text-red-800 mb-6 text-center border-b pb-3">
                                {ALL_CATEGORIES.find(cat => cat.key === selectedCategory)?.[currentLanguage] || UI_TEXTS['menu_title'][currentLanguage]}
                            </h2>

                            {/* パスタに関する注意書き */}
                            {selectedCategory === 'pasta-risotto' && (
                                <div className="bg-blue-50 border-l-4 border-blue-400 text-blue-800 p-4 mb-6 rounded-md shadow-sm" role="alert">
                                    <p className="font-semibold mb-2">{UI_TEXTS['pasta_note_gluten_free'][currentLanguage]}</p>
                                    <p className="text-sm">
                                        玄米スパゲッティ (Brown Rice Spaghetti)<br/>
                                        {currentLanguage === 'jp' ?
                                            `普通 +¥300(税込¥363)` :
                                            `Normal +$2.73(Tax incl.$3.30)`
                                        }
                                        <br/>
                                        {currentLanguage === 'jp' ?
                                            `大盛 +¥600(税込¥726)` :
                                            `Large +$5.45(Tax incl.$6.60)`
                                        }
                                    </p>
                                    <p className="font-semibold mt-3 mb-2">{UI_TEXTS['pasta_note_portions'][currentLanguage]}</p>
                                    <div className="flex justify-around items-center text-sm mb-2">
                                        <div className="text-center">
                                            <p className="font-medium">{UI_TEXTS['pasta_note_small'][currentLanguage]}</p>
                                            <p>35g</p>
                                        </div>
                                        <div className="text-center">
                                            <p className="font-medium">{UI_TEXTS['pasta_note_normal'][currentLanguage]}</p>
                                            <p>70g</p>
                                        </div>
                                        <div className="text-center">
                                            <p className="font-medium">{UI_TEXTS['pasta_note_large'][currentLanguage]}</p>
                                            <p>100g</p>
                                        </div>
                                        <div className="text-center">
                                            <p className="font-medium">{UI_TEXTS['pasta_note_extra_large'][currentLanguage]}</p>
                                            <p>140g</p>
                                        </div>
                                    </div>
                                    <p className="text-xs italic mt-2 text-right">{UI_TEXTS['pasta_note_price_change'][currentLanguage]}</p>
                                </div>
                            )}

                            {filteredMenuItems.length === 0 ? (
                                <p className="text-center text-gray-500 text-lg py-10">
                                    {UI_TEXTS['no_menu_available'][currentLanguage]}
                                </p>
                            ) : (
                                    selectedCategory === 'dolci-cafe' ? (
                                        <>
                                            <h3 className="font-playfair text-2xl font-semibold text-red-700 mb-4 text-center">
                                                {UI_TEXTS['desserts_title'][currentLanguage]}
                                            </h3>
                                            {dessertItems.length > 0 ? (
                                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 auto-rows-fr mb-8">
                                                    {dessertItems.map(item => (
                                                        <div
                                                            key={item.id}
                                                            className="relative bg-red-50 rounded-lg shadow-md hover:shadow-lg hover:scale-[1.02] transition-all duration-200 overflow-hidden flex flex-col cursor-pointer group"
                                                            onClick={() => { setSelectedDetailItem(item); setShowDetailModal(true); }}
                                                        >
                                                            {item.ImageUrl && ( // ImageUrlがある場合のみ表示
                                                                <img
                                                                    src={item.ImageUrl}
                                                                    alt={item.Name_jp}
                                                                    className="w-full h-40 object-cover"
                                                                    onError={(e) => e.target.src = 'https://placehold.co/400x200/CCCCCC/666666?text=Image+Not+Found'}
                                                                />
                                                            )}
                                                            <div className="p-4 flex-grow flex flex-col justify-between">
                                                                <div>
                                                                    <h3 className="font-playfair text-xl font-semibold text-red-800 mb-2">
                                                                        {item[`Name_${currentLanguage}`]}
                                                                    </h3>
                                                                    <div className="text-red-600 font-bold text-lg mb-2">
                                                                        {formatPriceDisplay(item[`PriceDisplay_${currentLanguage}`], currentLanguage)}
                                                                    </div>
                                                                    {item.Name_jp === '季節のフルーツ ロマノフ' && currentLanguage === 'jp' && (
                                                                        <p className="text-gray-500 text-xs italic mt-1">
                                                                            {UI_TEXTS['dessert_set_option'][currentLanguage]} +￥150（181）〉
                                                                        </p>
                                                                    )}
                                                                </div>
                                                                {isAdminMode && isAdminUser && ( // 管理者モードがONかつ管理者ユーザーである場合に表示
                                                                    <div className="flex justify-end space-x-2 mt-4">
                                                                        <button
                                                                            onClick={(e) => { e.stopPropagation(); setEditingItem(item); setShowItemModal(true); }}
                                                                            className="p-2 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors shadow-md"
                                                                            aria-label={UI_TEXTS['edit_item'][currentLanguage]}
                                                                        >
                                                                            <Edit className="w-5 h-5" />
                                                                        </button>
                                                                        <button
                                                                            onClick={(e) => { e.stopPropagation(); setItemToDelete(item); setShowConfirmModal(true); }}
                                                                            className="p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-md"
                                                                            aria-label={UI_TEXTS['delete_item'][currentLanguage]}
                                                                        >
                                                                            <Trash2 className="w-5 h-5" />
                                                                        </button>
                                                                    </div>
                                                                )}
                                                            </div>
                                                            {/* Tap for details indicator */}
                                                            <div className="absolute bottom-2 right-2 bg-red-600 text-white p-2 rounded-full shadow-lg flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none text-xs">
                                                                <Info className="w-4 h-4" />
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            ) : (
                                                <p className="text-center text-gray-500 text-md py-4">
                                                    {currentLanguage === 'jp' ? '現在、デザートメニューはありません。' : 'No dessert menu available.'}
                                                </p>
                                            )}

                                            <h3 className="font-playfair text-2xl font-semibold text-red-700 mb-4 text-center mt-8">
                                                {UI_TEXTS['cafe_title'][currentLanguage]}
                                            </h3>
                                            {cafeItems.length > 0 ? (
                                                <ul className="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-3">
                                                    {cafeItems.map(item => (
                                                        <li
                                                            key={item.id}
                                                            className="flex justify-between items-center bg-gray-50 p-3 rounded-lg shadow-sm text-lg hover:shadow-md hover:scale-[1.01] transition-all duration-200 cursor-pointer group"
                                                            onClick={() => { setSelectedDetailItem(item); setShowDetailModal(true); }}
                                                        >
                                                            <div className="flex flex-col flex-grow">
                                                                <span className="font-medium text-gray-800">
                                                                    {item[`Name_${currentLanguage}`]}
                                                                </span>
                                                                {(item.Name_jp.includes('カプチーノ') || item.Name_jp.includes('カフェラテ')) && currentLanguage === 'jp' && (
                                                                    <span className="text-gray-500 text-xs italic">
                                                                        {UI_TEXTS['set_option_prefix'][currentLanguage]} +50〉
                                                                    </span>
                                                                )}
                                                            </div>
                                                            <div className="font-bold text-red-600">
                                                                {formatPriceDisplay(item[`PriceDisplay_${currentLanguage}`], currentLanguage)}
                                                            </div>
                                                            {isAdminMode && isAdminUser && ( // 管理者モードがONかつ管理者ユーザーである場合に表示
                                                                <div className="flex-shrink-0 flex space-x-1 ml-4">
                                                                    <button
                                                                        onClick={(e) => { e.stopPropagation(); setEditingItem(item); setShowItemModal(true); }}
                                                                        className="p-1 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors shadow-md"
                                                                        aria-label={UI_TEXTS['edit_item'][currentLanguage]}
                                                                    >
                                                                        <Edit className="w-4 h-4" />
                                                                    </button>
                                                                    <button
                                                                        onClick={(e) => { e.stopPropagation(); setItemToDelete(item); setShowConfirmModal(true); }}
                                                                        className="p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-md"
                                                                        aria-label={UI_TEXTS['delete_item'][currentLanguage]}
                                                                    >
                                                                        <Trash2 className="w-4 h-4" />
                                                                    </button>
                                                                </div>
                                                            )}
                                                            {/* Tap for details indicator */}
                                                            <div className="flex-shrink-0 ml-2 text-red-600 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                                                                <ChevronRight className="w-5 h-5" />
                                                            </div>
                                                        </li>
                                                    ))}
                                                </ul>
                                            ) : (
                                                <p className="text-center text-gray-500 text-md py-4">
                                                    {currentLanguage === 'jp' ? '現在、カフェメニューはありません。' : 'No cafe menu available.'}
                                                </p>
                                            )}
                                        </>
                                    ) : selectedCategory === 'bevande' ? (
                                        // ドリンクカテゴリの特別表示
                                        <div className="space-y-8">
                                            {DRINK_SUB_CATEGORIES.map(subCategory => {
                                                const subCategoryItems = filteredMenuItems.filter(item => item.Type === subCategory.key);
                                                if (subCategoryItems.length === 0) return null;

                                                return (
                                                    <div key={subCategory.key} className="break-inside-avoid">
                                                        <h3 className="font-playfair text-2xl font-semibold text-red-700 mb-4 text-center mt-4">
                                                            {UI_TEXTS[`${subCategory.key.replace(/-/g, '_')}_title`][currentLanguage]}
                                                        </h3>
                                                        {subCategory.key === 'whisky' && (
                                                            <p className="text-center text-gray-600 text-sm italic mb-4">
                                                                {UI_TEXTS['whisky_note'][currentLanguage]}
                                                            </p>
                                                        )}
                                                        <div className={`grid gap-4 ${subCategory.hasImage ? 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3 auto-rows-fr' : 'grid-cols-1 md:grid-cols-2'}`}>
                                                            {subCategoryItems.map(item => (
                                                                <div
                                                                    key={item.id}
                                                                    className={`relative bg-red-50 rounded-lg shadow-md hover:shadow-lg hover:scale-[1.02] transition-all duration-200 overflow-hidden cursor-pointer group ${subCategory.hasImage ? 'flex flex-col' : 'flex justify-between items-center p-3 text-lg'}`}
                                                                    onClick={() => { setSelectedDetailItem(item); setShowDetailModal(true); }}
                                                                >
                                                                    {subCategory.hasImage && item.ImageUrl && (
                                                                        <img
                                                                            src={item.ImageUrl}
                                                                            alt={item.Name_jp}
                                                                            className="w-full h-40 object-cover"
                                                                            onError={(e) => e.target.src = 'https://placehold.co/400x200/CCCCCC/666666?text=Image+Not+Found'}
                                                                        />
                                                                    )}
                                                                    <div className={`p-4 ${subCategory.hasImage ? 'flex-grow flex flex-col justify-between' : 'flex-grow'}`}>
                                                                        <h3 className={`font-playfair ${subCategory.hasImage ? 'text-xl font-semibold' : 'text-lg font-medium'} text-red-800 mb-2`}>
                                                                            {item[`Name_${currentLanguage}`]}
                                                                        </h3>
                                                                        <div className="text-red-600 font-bold text-lg mb-2">
                                                                            {formatPriceDisplay(item[`PriceDisplay_${currentLanguage}`], currentLanguage)}
                                                                        </div>
                                                                    </div>
                                                                    {isAdminMode && isAdminUser && ( // 管理者モードがONかつ管理者ユーザーである場合に表示
                                                                        <div className={`flex justify-end space-x-2 ${subCategory.hasImage ? 'mt-4' : 'ml-4 flex-shrink-0'}`}>
                                                                            <button
                                                                                onClick={(e) => { e.stopPropagation(); setEditingItem(item); setShowItemModal(true); }}
                                                                                className="p-2 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors shadow-md"
                                                                                aria-label={UI_TEXTS['edit_item'][currentLanguage]}
                                                                            >
                                                                                <Edit className="w-5 h-5" />
                                                                            </button>
                                                                            <button
                                                                                onClick={(e) => { e.stopPropagation(); setItemToDelete(item); setShowConfirmModal(true); }}
                                                                                className="p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-md"
                                                                                aria-label={UI_TEXTS['delete_item'][currentLanguage]}
                                                                            >
                                                                                <Trash2 className="w-5 h-5" />
                                                                            </button>
                                                                        </div>
                                                                    )}
                                                                    {/* Tap for details indicator */}
                                                                    {subCategory.hasImage ? (
                                                                        <div className="absolute bottom-2 right-2 bg-red-600 text-white p-2 rounded-full shadow-lg flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none text-xs">
                                                                            <Info className="w-4 h-4" />
                                                                        </div>
                                                                    ) : (
                                                                        <div className="flex-shrink-0 ml-2 text-red-600 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                                                                            <ChevronRight className="w-5 h-5" />
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    ) : (
                                        // その他のカテゴリの通常表示
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 auto-rows-fr">
                                            {filteredMenuItems.map(item => (
                                                <div
                                                    key={item.id}
                                                    className="relative bg-red-50 rounded-lg shadow-md hover:shadow-lg hover:scale-[1.02] transition-all duration-200 overflow-hidden flex flex-col cursor-pointer group"
                                                    onClick={() => { setSelectedDetailItem(item); setShowDetailModal(true); }}
                                                >
                                                    {item.ImageUrl && (
                                                        <img
                                                            src={item.ImageUrl}
                                                            alt={item.Name_jp}
                                                            className="w-full h-40 object-cover"
                                                            onError={(e) => e.target.src = 'https://placehold.co/400x200/CCCCCC/666666?text=Image+Not+Found'}
                                                        />
                                                    )}
                                                    <div className="p-4 flex-grow flex flex-col justify-between">
                                                        <div>
                                                            <h3 className="font-playfair text-xl font-semibold text-red-800 mb-2">
                                                                {item[`Name_${currentLanguage}`]}
                                                            </h3>
                                                            <div className="text-red-600 font-bold text-lg mb-2">
                                                                {formatPriceDisplay(item[`PriceDisplay_${currentLanguage}`], currentLanguage)}
                                                            </div>
                                                        </div>
                                                        {isAdminMode && isAdminUser && ( // 管理者モードがONかつ管理者ユーザーである場合に表示
                                                            <div className="flex justify-end space-x-2 mt-4">
                                                                <button
                                                                    onClick={(e) => { e.stopPropagation(); setEditingItem(item); setShowItemModal(true); }}
                                                                    className="p-2 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors shadow-md"
                                                                    aria-label={UI_TEXTS['edit_item'][currentLanguage]}
                                                                >
                                                                    <Edit className="w-5 h-5" />
                                                                </button>
                                                                <button
                                                                    onClick={(e) => { e.stopPropagation(); setItemToDelete(item); setShowConfirmModal(true); }}
                                                                    className="p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-md"
                                                                    aria-label={UI_TEXTS['delete_item'][currentLanguage]}
                                                                >
                                                                    <Trash2 className="w-5 h-5" />
                                                                </button>
                                                            </div>
                                                        )}
                                                    </div>
                                                    {/* Tap for details indicator */}
                                                    <div className="absolute bottom-2 right-2 bg-red-600 text-white p-2 rounded-full shadow-lg flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none text-xs">
                                                        <Info className="w-4 h-4" />
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )
                            )}
                            {/* 管理者モードがONかつ管理者ユーザーである場合にのみ「新規追加」ボタンを表示 */}
                            {isAdminMode && isAdminUser && (
                                <div className="mt-8 text-center">
                                    <button
                                        onClick={() => { setEditingItem(null); setShowItemModal(true); }}
                                        className="inline-flex items-center px-6 py-3 bg-red-600 text-white rounded-full shadow-lg hover:bg-red-700 transition-colors duration-200 text-lg font-semibold transform hover:scale-105"
                                    >
                                        <Plus className="w-6 h-6 mr-2" />
                                        {UI_TEXTS['add_item'][currentLanguage]}
                                    </button>
                                </div>
                            )}
                        </>
                    )} {/* Closing the conditional rendering for isLoading */}
                </main> {/* This is the problematic line */}

                {/* フッター */}
                <footer className="bg-red-800 text-red-200 p-6 sm:p-8 text-center text-sm rounded-b-xl">
                    <p>&copy; 2025 LA GRANATA. All rights reserved.</p>
                </footer>
            </div>

            {/* モーダル表示 */}
            {showItemModal && (
                <MenuItemModal
                    item={editingItem}
                    onClose={() => { setShowItemModal(false); setEditingItem(null); }}
                    onSubmit={handleSaveItem}
                    currentLanguage={currentLanguage}
                    categories={ALL_CATEGORIES}
                />
            )}

            {showConfirmModal && (
                <ConfirmModal
                    show={showConfirmModal}
                    title={UI_TEXTS['confirm_delete_title'][currentLanguage]}
                    message={UI_TEXTS['confirm_delete_message'][currentLanguage]}
                    onConfirm={handleDeleteItem}
                    onCancel={() => { setShowConfirmModal(false); setItemToDelete(null); }}
                    currentLanguage={currentLanguage}
                />
            )}

            {showDetailModal && (
                <MenuItemDetailModal
                    item={selectedDetailItem}
                    allMenuItems={menuItems} // 全メニューアイテムを渡し、ペアリングを検索できるようにする
                    onClose={() => { setShowDetailModal(false); setSelectedDetailItem(null); }}
                    currentLanguage={currentLanguage}
                />
            )}
        </div>
    );
};

export default App;
